<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<title>Batch.v</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.16.0+0.16.3. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><div class="document">


<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> Tealeaves <span class="kn">Require Export</span>
  Functors.Batch
  Functors.VectorRefinement
  Functors.Backwards.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Import</span> Batch.Notations.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Import</span> Applicative.Notations.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input">#[local] <span class="kn">Generalizable Variables</span> <span class="nf">G</span> T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="sd">(** * Deconstructing &lt;&lt;Batch A B C&gt;&gt; via &lt;&lt;Vector&gt;&gt; *)</span>
<span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Module</span> <span class="nf">Deconstruction1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">deconstruction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input">#[local] <span class="kn">Arguments</span> Done {A B C}%type_scope _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input">#[local] <span class="kn">Arguments</span> Step {A B C}%type_scope _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">Batch_to_contents</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>} (<span class="nv">b</span>: Batch A B C):
      Vector.t A (length_Batch b) :=
      <span class="kr">match</span> b <span class="kr">return</span> (Vector.t A (length_Batch b)) <span class="kr">with</span>
      | Done c =&gt; Vector.nil A
      | Step rest a =&gt;
          Vector.cons A a (length_Batch rest) (Batch_to_contents rest)
      <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">Batch_to_makeFn</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>} (<span class="nv">b</span>: Batch A B C):
      Vector.t B (length_Batch b) -&gt; C :=
      <span class="kr">match</span> b <span class="kr">return</span> (Vector.t B (length_Batch b) -&gt; C) <span class="kr">with</span>
      | Done c =&gt;
          const c
      | Step rest a =&gt;
          <span class="kr">fun</span> (<span class="nv">v</span>: Vector.t B (S (length_Batch rest))) =&gt;
            <span class="kr">match</span> (Vector.uncons v) <span class="kr">with</span>
            | (b, v_rest) =&gt; Batch_to_makeFn rest v_rest b
            <span class="kr">end</span>
      <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk0"><span class="kn">Lemma</span> <span class="nf">Batch_to_contents_rw2</span>: <span class="kr">forall</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>} (<span class="nv">b</span>: Batch A B (B -&gt; C)) (<span class="nv">a</span>: A),
        Batch_to_contents (b ‚ßÜ a) =
          Vector.cons A a (length_Batch b) (Batch_to_contents b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B (B -&gt; C)) (<span class="nv">a</span> : A),
Batch_to_contents (b ‚ßÜ a) =
Vector.cons A a (length_Batch b) (Batch_to_contents b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B (B -&gt; C)) (<span class="nv">a</span> : A),
Batch_to_contents (b ‚ßÜ a) =
Vector.cons A a (length_Batch b) (Batch_to_contents b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk2"><span class="kn">Lemma</span> <span class="nf">Batch_to_makeFn_rw2</span>: <span class="kr">forall</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>} (<span class="nv">a</span>: A) (<span class="nv">b</span>: Batch A B (B -&gt; C)),
        Batch_to_makeFn (b ‚ßÜ a) =
          <span class="kr">fun</span> (<span class="nv">v</span>:Vector.t B (S (length_Batch b))) =&gt;
            <span class="kr">match</span> (Vector.uncons v) <span class="kr">with</span>
            | (b&#39;, v&#39;) =&gt; Batch_to_makeFn b v&#39; b&#39;
            <span class="kr">end</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">a</span> : A) (<span class="nv">b</span> : Batch A B (B -&gt; C)),
Batch_to_makeFn (b ‚ßÜ a) =
(<span class="kr">fun</span> <span class="nv">v</span> : Vector.t B (S (length_Batch b)) =&gt;
 <span class="kr">let</span> (<span class="nv">b&#39;</span>, v&#39;) := Vector.uncons v <span class="kr">in</span>
 Batch_to_makeFn b v&#39; b&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">a</span> : A) (<span class="nv">b</span> : Batch A B (B -&gt; C)),
Batch_to_makeFn (b ‚ßÜ a) =
(<span class="kr">fun</span> <span class="nv">v</span> : Vector.t B (S (length_Batch b)) =&gt;
 <span class="kr">let</span> (<span class="nv">b&#39;</span>, v&#39;) := Vector.uncons v <span class="kr">in</span>
 Batch_to_makeFn b v&#39; b&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk4"><span class="kn">Lemma</span> <span class="nf">Batch_repr</span> {<span class="nv">A</span> <span class="nv">C</span>}:
      <span class="kr">forall</span> (<span class="nv">b</span>: Batch A A C),
        Batch_to_makeFn b (Batch_to_contents b) = extract_Batch b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A A C,
Batch_to_makeFn b (Batch_to_contents b) =
extract_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk5"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A A C,
Batch_to_makeFn b (Batch_to_contents b) =
extract_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk6"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_to_makeFn b (Batch_to_contents b) =
extract_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk7"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_to_makeFn (Done c) (Batch_to_contents (Done c)) =
extract_Batch (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (Batch_to_contents b) = extract_Batch b</span></span></span><br></div><label class="goal-separator" for="batch-v-chk8"><hr></label><div class="goal-conclusion">Batch_to_makeFn (b ‚ßÜ a) (Batch_to_contents (b ‚ßÜ a)) =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk9">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_to_makeFn (Done c) (Batch_to_contents (Done c)) =
extract_Batch (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (Batch_to_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_to_makeFn (b ‚ßÜ a) (Batch_to_contents (b ‚ßÜ a)) =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (Batch_to_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_to_makeFn b (Batch_to_contents b) a =
extract_Batch b a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc"><span class="nb">rewrite</span> IHb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (Batch_to_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">extract_Batch b a = extract_Batch b a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(*</span>
<span class="c">  Lemma runBatch_repr `{Applicative G} {A B C}:</span>
<span class="c">    forall (f: A -&gt; G B) (b: Batch A B C),</span>
<span class="c">      runBatch G f C b =</span>
<span class="c">        pure (F := G)</span>
<span class="c">             (Batch_to_makeFn b) &lt;‚ãÜ&gt;</span>
<span class="c">                traverse (T := VEC (length_Batch b)) f (Batch_to_contents b).</span>
<span class="c">  Proof.</span>
<span class="c">    intros.</span>
<span class="c">    induction b.</span>
<span class="c">    - cbn.</span>
<span class="c">      rewrite ap2.</span>
<span class="c">      reflexivity.</span>
<span class="c">    - rewrite runBatch_rw2.</span>
<span class="c">      rewrite Batch_to_contents_rw2.</span>
<span class="c">      rewrite Batch_to_makeFn_rw2.</span>
<span class="c">      cbn.</span>
<span class="c">      rewrite &lt;- ap4.</span>
<span class="c">      rewrite ap2.</span>
<span class="c">      rewrite &lt;- ap4.</span>
<span class="c">      rewrite ap2.</span>
<span class="c">      rewrite ap2.</span>
<span class="c">      rewrite IHb.</span>
<span class="c">      reflexivity.</span>
<span class="c">  Qed.</span>
<span class="c">  *)</span>

</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">deconstruction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">Deconstruction1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="sd">(** * Deconstructing &lt;&lt;Batch A B C&gt;&gt; into shape and contents via</span>
<span class="sd">    refinement-style &lt;&lt;Vector&gt;&gt; *)</span>
<span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">deconstruction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input">#[local] <span class="kn">Arguments</span> Done {A B C}%type_scope _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input">#[local] <span class="kn">Arguments</span> Step {A B C}%type_scope _.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Generalizable Variables</span> <span class="nf">A</span> B C D n v a.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** Extract the contents of &lt;&lt;Batch&gt;&gt; as a vector *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">Batch_contents</span> `(b: Batch A B C):
    Vector (length_Batch b) A :=
    <span class="kr">match</span> b <span class="kr">with</span>
    | Done c =&gt; vnil
    | Step b a =&gt; vcons (length_Batch b) a (Batch_contents b)
    <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** Obtain the build function of &lt;&lt;Batch&gt;&gt;. Note that</span>
<span class="sd"> &lt;&lt;Batch_make b v&gt;&gt; in general has type &lt;&lt;C&gt;&gt;, not another &lt;&lt;Batch&gt;&gt;.</span>
<span class="sd"> That is, this is not &lt;&lt;make&gt;&gt; in the sense of &lt;&lt;put&gt;&gt; *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">Batch_make</span> `(b: Batch A B C):
    Vector (length_Batch b) B -&gt; C :=
    <span class="kr">match</span> b <span class="kr">return</span> Vector (length_Batch b) B -&gt; C <span class="kr">with</span>
    | Done c =&gt; <span class="kr">fun</span> <span class="nv">v</span> =&gt; c
    | Step b a =&gt; <span class="kr">fun</span> <span class="nv">v</span> =&gt;
                   Batch_make b (Vector_tl v) (Vector_hd v)
    <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** This is &lt;&lt;make&gt;&gt; in the sense of &lt;&lt;put&gt;&gt;. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">Batch_replace_contents</span>
             `(b: Batch A B C)
             `(v: Vector (length_Batch b) A&#39;)
    : Batch A&#39; B C :=
    <span class="kr">match</span> b <span class="kr">return</span> (Vector (length_Batch b) A&#39; -&gt; Batch A&#39; B C) <span class="kr">with</span>
    | Done c =&gt;
        <span class="kr">fun</span> <span class="nv">v</span> =&gt; Done c
    | Step rest a =&gt;
        <span class="kr">fun</span> <span class="nv">v</span> =&gt;
          Step (Batch_replace_contents rest (Vector_tl v))
               (Vector_hd v)
    <span class="kr">end</span> v.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Rewriting rules *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">rw</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>: <span class="kt">Type</span>}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Implicit Types</span> (<span class="nv">a</span>: A) (<span class="nv">b</span>: Batch A B (B -&gt; C)) (<span class="nv">c</span>: C).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd"><span class="kn">Lemma</span> <span class="nf">Batch_contents_rw1</span> {<span class="nv">c</span>}:
      Batch_contents (@Done A B C c) = vnil.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (Done c) = vnil</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (Done c) = vnil</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf"><span class="kn">Lemma</span> <span class="nf">Batch_contents_rw2</span> {<span class="nv">b</span> <span class="nv">a</span>}:
      Batch_contents (Step b a) =
        vcons (length_Batch b) a (Batch_contents b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (b ‚ßÜ a) =
vcons (length_Batch b) a (Batch_contents b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk10"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (b ‚ßÜ a) =
vcons (length_Batch b) a (Batch_contents b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk11"><span class="kn">Lemma</span> <span class="nf">Batch_make_rw1</span> {<span class="nv">c</span>}:
      Batch_make (@Done A B C c) = const c.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Done c) = const c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk12"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Done c) = const c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk13"><span class="kn">Lemma</span> <span class="nf">Batch_make_rw2</span> {<span class="nv">b</span> <span class="nv">a</span>}:
      Batch_make (Step b a) =
        <span class="kr">fun</span> <span class="nv">v</span> =&gt; Batch_make b (Vector_tl v) (Vector_hd v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (b ‚ßÜ a) =
(<span class="kr">fun</span> <span class="nv">v</span> : Vector (length_Batch (b ‚ßÜ a)) B =&gt;
 Batch_make b (Vector_tl v) (Vector_hd v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk14"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (b ‚ßÜ a) =
(<span class="kr">fun</span> <span class="nv">v</span> : Vector (length_Batch (b ‚ßÜ a)) B =&gt;
 Batch_make b (Vector_tl v) (Vector_hd v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk15"><span class="kn">Lemma</span> <span class="nf">Batch_replace_rw1</span> {<span class="nv">c</span>} `{v: Vector _ A&#39;}:
      Batch_replace_contents (@Done A B C c) v = Done c.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) v = Done c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk16"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) v = Done c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk17"><span class="kn">Lemma</span> <span class="nf">Batch_replace_rw2</span> {<span class="nv">b</span> <span class="nv">a</span>} `{v: Vector _ A&#39;}:
      Batch_replace_contents (Step b a) v =
        Step (Batch_replace_contents b (Vector_tl v)) (Vector_hd v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a) v =
Batch_replace_contents b (Vector_tl v) ‚ßÜ Vector_hd v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk18"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a) v =
Batch_replace_contents b (Vector_tl v) ‚ßÜ Vector_hd v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">rw</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Lemmas regarding &lt;&lt;shape&gt;&gt; *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">shape_lemmas</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">shape_induction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span>
        {<span class="nv">A1</span> <span class="nv">A2</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>}
          {<span class="nv">b1</span>: Batch A1 B C}
          {<span class="nv">b2</span>: Batch A2 B C}
          (<span class="nv">Hshape</span>: shape b1 = shape b2)
          (<span class="nv">P</span> : <span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
              Batch A1 B C -&gt;
              Batch A2 B C -&gt;
              <span class="kt">Prop</span>)
          (<span class="nv">IHdone</span>:
            <span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C), P C (Done c) (Done c))
          (<span class="nv">IHstep</span>:
            <span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>)
              (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
              (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
              P (B -&gt; C) b1 b2 -&gt;
              <span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span>: A2)
                (<span class="nv">Hshape</span>: shape (Step b1 a1) = shape (Step b2 a2)),
                P C (Step b1 a1) (Step b2 a2)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk19"><span class="kn">Lemma</span> <span class="nf">Batch_shape_ind</span>: P C b1 b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C b1 b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C b1 b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b"><span class="nb">induction</span> b1 <span class="kr">as</span> [C c | C rest IHrest a].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape b2</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (Done c) b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape b2</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1c"><hr></label><div class="goal-conclusion">P C (rest ‚ßÜ a) b2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape b2</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (Done c) b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e"><span class="nb">destruct</span> b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>c, c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (Done c0)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (Done c) (Done c0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (b ‚ßÜ a)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1f"><hr></label><div class="goal-conclusion">P C (Done c) (b ‚ßÜ a)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk20">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>c, c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (Done c0)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (Done c) (Done c0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">inversion</span> Hshape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk21">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (b ‚ßÜ a)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (Done c) (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">false.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk22">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape b2</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (rest ‚ßÜ a) b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk23"><span class="nb">destruct</span> b2 <span class="kr">as</span> [c&#39; | rest&#39; a&#39;].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>c'</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (Done c&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (rest ‚ßÜ a) (Done c&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk24" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk24"><hr></label><div class="goal-conclusion">P C (rest ‚ßÜ a) (rest&#39; ‚ßÜ a&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk25">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>c'</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (Done c&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (rest ‚ßÜ a) (Done c&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">false.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk26">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P C (rest ‚ßÜ a) (rest&#39; ‚ßÜ a&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk27"><span class="nb">apply</span> IHstep.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (B -&gt; C) rest rest&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk28" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk28"><hr></label><div class="goal-conclusion">shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk29">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (B -&gt; C) rest rest&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk2a"><span class="nb">apply</span> IHrest.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch A1 B (B -&gt; C)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk2b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk2b"><hr></label><div class="goal-conclusion">shape rest = shape rest&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">              </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk2c"><span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape rest = shape rest&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">              </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">inversion</span> Hshape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk2d">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, A2, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>rest'</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a'</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">C</span> : <span class="kt">Type</span>,
Batch A1 B C -&gt; Batch A2 B C -&gt; <span class="kt">Prop</span></span></span></span><br><span><var>IHdone</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
P C (Done c) (Done c)</span></span></span><br><span><var>IHstep</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
P (B -&gt; C) b1 b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
P C (b1 ‚ßÜ a1) (b2 ‚ßÜ a2)</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C) -&gt;
<span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape rest = shape b2 -&gt; P (B -&gt; C) rest b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (rest ‚ßÜ a) = shape (rest&#39; ‚ßÜ a&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Hshape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">shape_induction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk2e"><span class="kn">Lemma</span> <span class="nf">length_Batch_shape</span>:
      <span class="kr">forall</span> `(b1: Batch A1 B C)
        `(b2: Batch A2 B C),
        shape b1 = shape b2 -&gt;
        length_Batch b1 = length_Batch b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk2f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk2f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk30">introv Hshape.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch b1 = length_Batch b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk31"><span class="nb">induction</span> b1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) = length_Batch b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk32" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape b2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk32"><hr></label><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a) = length_Batch b2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk33">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) = length_Batch b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk34"><span class="nb">destruct</span> b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (Done c0)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) = length_Batch (Done c0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk35" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (b2 ‚ßÜ a)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk35"><hr></label><div class="goal-conclusion">length_Batch (Done c) = length_Batch (b2 ‚ßÜ a)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk36">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (Done c0)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) = length_Batch (Done c0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">inversion</span> Hshape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk37">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (Done c) = shape (b2 ‚ßÜ a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) = length_Batch (b2 ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">false.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk38">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape b2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a) = length_Batch b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk39"><span class="nb">destruct</span> b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape (Done c)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a) = length_Batch (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk3a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape (b2 ‚ßÜ a0)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk3a"><hr></label><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk3b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape (Done c)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a) = length_Batch (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">false.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk3c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk3c">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape (b2 ‚ßÜ a0)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk3d"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape (b2 ‚ßÜ a0)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (length_Batch b1) = S (length_Batch b2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk3e">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape (b2 ‚ßÜ a0)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch b1 = length_Batch b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk3f"><span class="nb">apply</span> IHb1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a) = shape (b2 ‚ßÜ a0)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
shape b1 = shape b2 -&gt;
length_Batch b1 = length_Batch b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">inversion</span> Hshape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk40"><span class="kn">Lemma</span> <span class="nf">Batch_make_shape</span>:
      <span class="kr">forall</span> `(b1: Batch A1 B C) `(b2: Batch A2 B C),
        shape b1 = shape b2 -&gt;
        Batch_make b1 ~!~ Batch_make b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 -&gt; Batch_make b1 ~!~ Batch_make b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk41"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 -&gt; Batch_make b1 ~!~ Batch_make b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk42">introv Hshape.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 ~!~ Batch_make b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk43"><span class="nb">apply</span> (Batch_shape_ind Hshape).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
Batch_make (Done c) ~!~ Batch_make (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk44" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk44"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
Batch_make b1 ~!~ Batch_make b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
Batch_make (b1 ‚ßÜ a1) ~!~ Batch_make (b2 ‚ßÜ a2)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk45">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
Batch_make (Done c) ~!~ Batch_make (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">split</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk46">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
Batch_make b1 ~!~ Batch_make b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
Batch_make (b1 ‚ßÜ a1) ~!~ Batch_make (b2 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk47"><span class="nb">clear</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
Batch_make b1 ~!~ Batch_make b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
Batch_make (b1 ‚ßÜ a1) ~!~ Batch_make (b2 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk48">introv Hsim; introv Hshape.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (b1 ‚ßÜ a1) ~!~ Batch_make (b2 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk49"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a1) = length_Batch (b2 ‚ßÜ a2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk4a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk4a"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a1)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a2)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a1) v1 = Batch_make (b2 ‚ßÜ a2) v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk4b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b1 ‚ßÜ a1) = length_Batch (b2 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto using</span> length_Batch_shape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk4c">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a1)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a2)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a1) v1 = Batch_make (b2 ‚ßÜ a2) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk4d">introv Hsim&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b1 ‚ßÜ a1)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b2 ‚ßÜ a2)) B</span></span></span><br><span><var>Hsim'</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (b1 ‚ßÜ a1) v1 = Batch_make (b2 ‚ßÜ a2) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk4e"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">rewrite</span> Batch_make_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b1 ‚ßÜ a1)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b2 ‚ßÜ a2)) B</span></span></span><br><span><var>Hsim'</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 (Vector_tl v1) (Vector_hd v1) =
Batch_make b2 (Vector_tl v2) (Vector_hd v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk4f"><span class="nb">rewrite</span> (Vector_hd_sim Hsim&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b1 ‚ßÜ a1)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b2 ‚ßÜ a2)) B</span></span></span><br><span><var>Hsim'</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 (Vector_tl v1) (Vector_hd v2) =
Batch_make b2 (Vector_tl v2) (Vector_hd v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk50"><span class="nb">enough</span>
            (<span class="nb">cut</span>: Batch_make b1 (Vector_tl v1) =
                    Batch_make b2 (Vector_tl v2))
            <span class="bp">by</span> <span class="bp">now</span> <span class="nb">rewrite</span> <span class="nb">cut</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C)</span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b1 ‚ßÜ a1)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b2 ‚ßÜ a2)) B</span></span></span><br><span><var>Hsim'</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 (Vector_tl v1) =
Batch_make b2 (Vector_tl v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto using</span> Vector_fun_sim_eq, Vector_tl_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
    <span class="c">(* This is true, but to prove it we need more lemmas *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk51"><span class="kn">Lemma</span> <span class="nf">Batch_make_shape_rev</span>:
      <span class="kr">forall</span> `(b1: Batch A1 B C) `(b2: Batch A2 B C),
        Batch_make b1 ~!~ Batch_make b2 -&gt;
        shape b1 = shape b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
Batch_make b1 ~!~ Batch_make b2 -&gt; shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk52"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
Batch_make b1 ~!~ Batch_make b2 -&gt; shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Abort</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk53"><span class="kn">Lemma</span> <span class="nf">Batch_replace_shape</span>:
      <span class="kr">forall</span> `(b1: Batch A1 B C) `(b2: Batch A2 B C),
        shape b1 = shape b2 -&gt;
        <span class="kr">forall</span> (<span class="nv">A&#39;</span>: <span class="kt">Type</span>),
          Batch_replace_contents
            (A&#39; := A&#39;) b1
            ~!~ Batch_replace_contents
            (A&#39; := A&#39;) b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 -&gt;
<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk54"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 -&gt;
<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk55">introv Hshape.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk56" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk56"><span class="nb">apply</span> (Batch_shape_ind Hshape).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C) (<span class="nv">A&#39;</span> : <span class="kt">Type</span>),
Batch_replace_contents (Done c) ~!~
Batch_replace_contents (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk57" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk57"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
(<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
 Batch_replace_contents b1 ~!~
 Batch_replace_contents b2) -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents (b1 ‚ßÜ a1) ~!~
Batch_replace_contents (b2 ‚ßÜ a2)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk58">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C) (<span class="nv">A&#39;</span> : <span class="kt">Type</span>),
Batch_replace_contents (Done c) ~!~
Batch_replace_contents (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk59"><span class="nb">clear</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C) (<span class="nv">A&#39;</span> : <span class="kt">Type</span>),
Batch_replace_contents (Done c) ~!~
Batch_replace_contents (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk5a"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, A2, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) ~!~
Batch_replace_contents (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">split</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk5b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
(<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
 Batch_replace_contents b1 ~!~
 Batch_replace_contents b2) -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents (b1 ‚ßÜ a1) ~!~
Batch_replace_contents (b2 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk5c"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b0 ‚ßÜ a1) ~!~
Batch_replace_contents (b3 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk5d"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b0 ‚ßÜ a1) = length_Batch (b3 ‚ßÜ a2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk5e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><label class="goal-separator" for="batch-v-chk5e"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;),
v1 ~~ v2 -&gt;
Batch_replace_contents (b0 ‚ßÜ a1) v1 =
Batch_replace_contents (b3 ‚ßÜ a2) v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk5f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk5f">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b0 ‚ßÜ a1) = length_Batch (b3 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto using</span> length_Batch_shape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk60">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;),
v1 ~~ v2 -&gt;
Batch_replace_contents (b0 ‚ßÜ a1) v1 =
Batch_replace_contents (b3 ‚ßÜ a2) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk61" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk61">introv Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b0 ‚ßÜ a1) v1 =
Batch_replace_contents (b3 ‚ßÜ a2) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk62" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk62"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">rewrite</span> Batch_replace_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b0 (Vector_tl v1)
‚ßÜ Vector_hd v1 =
Batch_replace_contents b3 (Vector_tl v2)
‚ßÜ Vector_hd v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk63" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk63"><span class="nb">rewrite</span> (Vector_hd_sim Hsim).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b0 (Vector_tl v1)
‚ßÜ Vector_hd v2 =
Batch_replace_contents b3 (Vector_tl v2)
‚ßÜ Vector_hd v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk64" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk64">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b0 (Vector_tl v1) =
Batch_replace_contents b3 (Vector_tl v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk65"><span class="nb">apply</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Vector_tl v1 ~~ Vector_tl v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto using</span> Vector_tl_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk66"><span class="kn">Lemma</span> <span class="nf">Batch_shape_spec</span>:
      <span class="kr">forall</span> `(b: Batch A B C),
        shape b =
          Batch_replace_contents b (Vector_tt (length_Batch b)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C),
shape b =
Batch_replace_contents b (Vector_tt (length_Batch b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk67"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C),
shape b =
Batch_replace_contents b (Vector_tt (length_Batch b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk68"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b =
Batch_replace_contents b (Vector_tt (length_Batch b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk69" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk69"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) =
Batch_replace_contents (Done c)
  (Vector_tt (length_Batch (Done c)))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk6a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>shape b = Batch_replace_contents b (Vector_tt (length_Batch b))</span></span></span><br></div><label class="goal-separator" for="batch-v-chk6a"><hr></label><div class="goal-conclusion">shape (b ‚ßÜ a) =
Batch_replace_contents (b ‚ßÜ a)
  (Vector_tt (length_Batch (b ‚ßÜ a)))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk6b">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) =
Batch_replace_contents (Done c)
  (Vector_tt (length_Batch (Done c)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk6c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk6c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>shape b = Batch_replace_contents b (Vector_tt (length_Batch b))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (b ‚ßÜ a) =
Batch_replace_contents (b ‚ßÜ a)
  (Vector_tt (length_Batch (b ‚ßÜ a)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk6d"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>shape b = Batch_replace_contents b (Vector_tt (length_Batch b))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b ‚ßÜ const tt a =
Batch_replace_contents b
  (Vector_tl
     (vcons (length_Batch b) tt
        (Vector_repeat (length_Batch b) tt)))
‚ßÜ Vector_hd
    (vcons (length_Batch b) tt
       (Vector_repeat (length_Batch b) tt))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk6e"><span class="nb">rewrite</span> Vector_tl_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>shape b = Batch_replace_contents b (Vector_tt (length_Batch b))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b ‚ßÜ const tt a =
Batch_replace_contents b
  (Vector_repeat (length_Batch b) tt)
‚ßÜ Vector_hd
    (vcons (length_Batch b) tt
       (Vector_repeat (length_Batch b) tt))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk6f"><span class="nb">rewrite</span> Vector_hd_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>shape b = Batch_replace_contents b (Vector_tt (length_Batch b))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b ‚ßÜ const tt a =
Batch_replace_contents b
  (Vector_repeat (length_Batch b) tt) ‚ßÜ tt</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk70" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk70">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>shape b = Batch_replace_contents b (Vector_tt (length_Batch b))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b =
Batch_replace_contents b
  (Vector_repeat (length_Batch b) tt)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> IHb.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">shape_lemmas</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Lemmas regarding &lt;&lt;Batch_make&gt;&gt; *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">Batch_make</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk71" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk71"><span class="kn">Lemma</span> <span class="nf">Batch_make_sim1</span>
            `(b: Batch A B C)
            `{v1: Vector (length_Batch b) B}
            `{v2: Vector (length_Batch b) B}
            (Hsim: v1 ~~ v2):
      Batch_make b v1 = Batch_make b v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b v1 = Batch_make b v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk72" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk72"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b v1 = Batch_make b v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk73" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk73"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Done c) v1 = Batch_make (Done c) v2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk74" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) B,
v1 ~~ v2 -&gt; Batch_make b v1 = Batch_make b v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk74"><hr></label><div class="goal-conclusion">Batch_make (b ‚ßÜ a) v1 = Batch_make (b ‚ßÜ a) v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk75" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk75">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Done c) v1 = Batch_make (Done c) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk76">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) B,
v1 ~~ v2 -&gt; Batch_make b v1 = Batch_make b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (b ‚ßÜ a) v1 = Batch_make (b ‚ßÜ a) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk77" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk77"><span class="nb">rewrite</span> Batch_make_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) B,
v1 ~~ v2 -&gt; Batch_make b v1 = Batch_make b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b (Vector_tl v1) (Vector_hd v1) =
Batch_make b (Vector_tl v2) (Vector_hd v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk78" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk78"><span class="nb">rewrite</span> (IHb _ _ (Vector_tl_sim Hsim)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) B,
v1 ~~ v2 -&gt; Batch_make b v1 = Batch_make b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b (Vector_tl v2) (Vector_hd v1) =
Batch_make b (Vector_tl v2) (Vector_hd v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk79"><span class="nb">rewrite</span> (Vector_hd_sim Hsim).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) B,
v1 ~~ v2 -&gt; Batch_make b v1 = Batch_make b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b (Vector_tl v2) (Vector_hd v2) =
Batch_make b (Vector_tl v2) (Vector_hd v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
    <span class="c">(* This sort of lemma is very useful when the complexity of expression</span>
<span class="c">     &lt;&lt;v1&gt;&gt; and &lt;&lt;v2&gt;&gt; obstructs tactics like &lt;&lt;rewrite&gt;&gt; *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk7a"><span class="kn">Lemma</span> <span class="nf">Batch_make_sim2</span>
            `(b1: Batch A B C)
            `(b2: Batch A B C)
            `{v1: Vector (length_Batch b1) B}
            `{v2: Vector (length_Batch b2) B}
            (Heq: b1 = b2)
            (Hsim: v1 ~~ v2):
      Batch_make b1 v1 = Batch_make b2 v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>b1 = b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk7b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk7b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>b1 = b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> (<span class="nb">subst</span>; <span class="nb">apply</span> Batch_make_sim1).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk7c"><span class="kn">Lemma</span> <span class="nf">Batch_make_sim3</span>
            `(b1: Batch A1 B C)
            `(b2: Batch A2 B C)
            `{v1: Vector (length_Batch b1) B}
            `{v2: Vector (length_Batch b2) B}
            (Heq: shape b1 = shape b2)
            (Hsim: v1 ~~ v2):
      Batch_make b1 v1 = Batch_make b2 v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk7d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk7d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk7e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk7e"><span class="nb">apply</span> Vector_fun_sim_eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 ~!~ Batch_make b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk7f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk7f"><hr></label><div class="goal-conclusion">v1 ~~ v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk80" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk80"><span class="nb">apply</span> Batch_make_shape.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b1 = shape b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk81" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk81"><hr></label><div class="goal-conclusion">v1 ~~ v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk82" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk82"><span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v1 ~~ v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk83"><span class="kn">Lemma</span> <span class="nf">Batch_make_coerce</span>
            `(b: Batch A B C)
            `{v1: Vector (length_Batch b) B}
            `{v2: Vector n B}
            (Heq: n = length_Batch b):
      v1 ~~ v2 -&gt;
      Batch_make b v1 = Batch_make b (coerce Heq <span class="kr">in</span> v2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector n B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>n = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v1 ~~ v2 -&gt;
Batch_make b v1 = Batch_make b (coerce Heq <span class="kr">in</span> v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk84" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk84"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector n B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>n = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v1 ~~ v2 -&gt;
Batch_make b v1 = Batch_make b (coerce Heq <span class="kr">in</span> v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk85" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk85"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v1 ~~ v2 -&gt;
Batch_make b v1 = Batch_make b (coerce eq_refl <span class="kr">in</span> v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk86" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk86"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b v1 = Batch_make b (coerce eq_refl <span class="kr">in</span> v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk87"><span class="nb">apply</span> Batch_make_sim1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v1 ~~ coerce eq_refl <span class="kr">in</span> v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk88" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk88"><span class="nb">rewrite</span> coerce_Vector_eq_refl.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v1 ~~ v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
    <span class="sd">(** Rewrite the &lt;&lt;Batch&gt;&gt; argument to an equal one by</span>
<span class="sd">      coercing the length proof in the vector. *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk89" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk89"><span class="kn">Lemma</span> <span class="nf">Batch_make_rw</span>
            `(b1: Batch A B C)
            `(b2: Batch A B C)
            `{v: Vector (length_Batch b1) B}
            (Heq: b1 = b2):
      Batch_make b1 v =
        Batch_make b2 (rew [<span class="kr">fun</span> <span class="nv">b</span> =&gt; Vector (length_Batch b) B]
                           Heq <span class="kr">in</span> v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>b1 = b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v =
Batch_make b2
  (rew [<span class="kr">fun</span> <span class="nv">b</span> : Batch A B C =&gt;
        Vector (length_Batch b) B] Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk8a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk8a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>b1 = b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v =
Batch_make b2
  (rew [<span class="kr">fun</span> <span class="nv">b</span> : Batch A B C =&gt;
        Vector (length_Batch b) B] Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> (<span class="nb">subst</span>; <span class="nb">apply</span> Batch_make_sim1).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk8b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk8b"><span class="kn">Lemma</span> <span class="nf">Batch_make_compose</span>
            `(b: Batch A B C)
            `(f: C -&gt; D)
            `(Hsim: v1 ~~ v2):
      f (Batch_make b v1) =
        Batch_make (map (F := Batch A B) f b) v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map f b)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make b v1) = Batch_make (map f b) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk8c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk8c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map f b)) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make b v1) = Batch_make (map f b) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk8d"><span class="nb">generalize dependent</span> v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v2</span> : Vector (length_Batch (map f b)) B,
v1 ~~ v2 -&gt;
f (Batch_make b v1) = Batch_make (map f b) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk8e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk8e"><span class="nb">generalize dependent</span> v1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f b)) B),
v1 ~~ v2 -&gt;
f (Batch_make b v1) = Batch_make (map f b) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk8f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk8f"><span class="nb">generalize dependent</span> D.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : C -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch b) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f b)) B),
v1 ~~ v2 -&gt;
f (Batch_make b v1) = Batch_make (map f b) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk90" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk90"><span class="nb">induction</span> b <span class="kr">as</span> [C c | C rest IHrest].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : C -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f (Done c))) B),
v1 ~~ v2 -&gt;
f (Batch_make (Done c) v1) =
Batch_make (map f (Done c)) v2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk91" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk91"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : C -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch (rest ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f (rest ‚ßÜ a))) B),
v1 ~~ v2 -&gt;
f (Batch_make (rest ‚ßÜ a) v1) =
Batch_make (map f (rest ‚ßÜ a)) v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk92" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk92">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : C -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f (Done c))) B),
v1 ~~ v2 -&gt;
f (Batch_make (Done c) v1) =
Batch_make (map f (Done c)) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk93" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk93">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : C -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch (rest ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f (rest ‚ßÜ a))) B),
v1 ~~ v2 -&gt;
f (Batch_make (rest ‚ßÜ a) v1) =
Batch_make (map f (rest ‚ßÜ a)) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk94" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk94"><span class="nb">intros</span> D f v1 v2 Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (rest ‚ßÜ a)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map f (rest ‚ßÜ a))) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make (rest ‚ßÜ a) v1) =
Batch_make (map f (rest ‚ßÜ a)) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk95" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk95"><span class="nb">change</span> (map f (Step rest a)) <span class="kr">with</span>
          (Step (map (compose f) rest) a) <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (rest ‚ßÜ a)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map (compose f) rest ‚ßÜ a))
  B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make (rest ‚ßÜ a) v1) =
Batch_make (map (compose f) rest ‚ßÜ a) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk96" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk96"><span class="nb">cbn</span> <span class="kr">in</span> v2, v1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch rest)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch (map (compose f) rest)))
  B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make (rest ‚ßÜ a) v1) =
Batch_make (map (compose f) rest ‚ßÜ a) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk97" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk97"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">rewrite</span> Batch_make_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch rest)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch (map (compose f) rest)))
  B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make rest (Vector_tl v1) (Vector_hd v1)) =
Batch_make (map (compose f) rest) (Vector_tl v2)
  (Vector_hd v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk98" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk98"><span class="nb">rewrite</span> &lt;- (Vector_hd_sim Hsim).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch rest)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch (map (compose f) rest)))
  B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make rest (Vector_tl v1) (Vector_hd v1)) =
Batch_make (map (compose f) rest) (Vector_tl v2)
  (Vector_hd v1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk99" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk99">change_left ((f ‚àò Batch_make rest (Vector_tl v1)) (Vector_hd v1)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">D</span> : <span class="kt">Type</span>) (<span class="nv">f</span> : (B -&gt; C) -&gt; D)
  (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector (length_Batch (map f rest)) B),
v1 ~~ v2 -&gt;
f (Batch_make rest v1) =
Batch_make (map f rest) v2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch rest)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch (map (compose f) rest)))
  B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(f ‚àò Batch_make rest (Vector_tl v1)) (Vector_hd v1) =
Batch_make (map (compose f) rest) (Vector_tl v2)
  (Vector_hd v1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk9a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk9a"><span class="nb">specialize</span> (IHrest _ (compose f)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector
          (length_Batch
             (map (compose f) rest)) B),
v1 ~~ v2 -&gt;
f ‚àò Batch_make rest v1 =
Batch_make (map (compose f) rest) v2</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch rest)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch (map (compose f) rest)))
  B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(f ‚àò Batch_make rest (Vector_tl v1)) (Vector_hd v1) =
Batch_make (map (compose f) rest) (Vector_tl v2)
  (Vector_hd v1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk9b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk9b"><span class="nb">rewrite</span> (IHrest (Vector_tl v1) (Vector_tl v2) (Vector_tl_sim Hsim)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>rest</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>IHrest</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch rest) B)
  (<span class="nv">v2</span> : Vector
          (length_Batch
             (map (compose f) rest)) B),
v1 ~~ v2 -&gt;
f ‚àò Batch_make rest v1 =
Batch_make (map (compose f) rest) v2</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch rest)) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch (map (compose f) rest)))
  B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (map (compose f) rest) (Vector_tl v2)
  (Vector_hd v1) =
Batch_make (map (compose f) rest) (Vector_tl v2)
  (Vector_hd v1)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk9c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk9c"><span class="kn">Lemma</span> <span class="nf">Batch_make_compose_rw1</span>
            `(b: Batch A B C)
            `(f: C -&gt; D)
            (v: Vector (length_Batch b) B):
      f (Batch_make b v) =
        Batch_make (map (F := Batch A B) f b)
                   (coerce (batch_length_map _ _) <span class="kr">in</span> v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make b v) =
Batch_make (map f b)
  (coerce batch_length_map f b <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk9d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk9d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f (Batch_make b v) =
Batch_make (map f b)
  (coerce batch_length_map f b <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">rewrite</span> (
              Batch_make_compose
                b f
                (v1 := v)
                (v2 :=coerce_Vector_length (batch_length_map _ _) v)
            ) <span class="bp">by</span> vector_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk9e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk9e"><span class="kn">Lemma</span> <span class="nf">Batch_make_compose_rw2</span> `(b: Batch A B C) `(f: C -&gt; D) v:
      Batch_make (map (F := Batch A B) f b) v =
        f (Batch_make b (coerce_Vector_length (eq_sym (batch_length_map _ _)) v)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map f b)) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (map f b) v =
f
  (Batch_make b
     (coerce eq_sym (batch_length_map f b) <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk9f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk9f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map f b)) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (map f b) v =
f
  (Batch_make b
     (coerce eq_sym (batch_length_map f b) <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka0"><span class="nb">rewrite</span> (Batch_make_compose_rw1 b f).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map f b)) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (map f b) v =
Batch_make (map f b)
  (coerce batch_length_map f b
   <span class="kr">in</span> coerce eq_sym (batch_length_map f b) <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka1"><span class="nb">apply</span> Batch_make_sim1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; D</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (map f b)) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v ~~
coerce batch_length_map f b
<span class="kr">in</span> coerce eq_sym (batch_length_map f b) <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input">vector_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">Batch_make</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Lemmas regarding &lt;&lt;Batch_contents&gt;&gt; *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka2"><span class="kn">Lemma</span> <span class="nf">Batch_contents_natural</span>: <span class="kr">forall</span> `(b: Batch A B C) `(f: A -&gt; A&#39;),
      map f (Batch_contents b) ~~ Batch_contents (mapfst_Batch _ _ f b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">A&#39;</span> : <span class="kt">Type</span>)
  (<span class="nv">f</span> : A -&gt; A&#39;),
map f (Batch_contents b) ~~
Batch_contents (mapfst_Batch A A&#39; f b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">A&#39;</span> : <span class="kt">Type</span>)
  (<span class="nv">f</span> : A -&gt; A&#39;),
map f (Batch_contents b) ~~
Batch_contents (mapfst_Batch A A&#39; f b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka4"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_contents b) ~~
Batch_contents (mapfst_Batch A A&#39; f b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka5"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_contents (Done c)) ~~
Batch_contents (mapfst_Batch A A&#39; f (Done c))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chka6" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map f (Batch_contents b) ~~ Batch_contents (mapfst_Batch A A&#39; f b)</span></span></span><br></div><label class="goal-separator" for="batch-v-chka6"><hr></label><div class="goal-conclusion">map f (Batch_contents (b ‚ßÜ a)) ~~
Batch_contents (mapfst_Batch A A&#39; f (b ‚ßÜ a))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_contents (Done c)) ~~
Batch_contents (mapfst_Batch A A&#39; f (Done c))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map f (Batch_contents b) ~~ Batch_contents (mapfst_Batch A A&#39; f b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_contents (b ‚ßÜ a)) ~~
Batch_contents (mapfst_Batch A A&#39; f (b ‚ßÜ a))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chka9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chka9"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map f (Batch_contents b) ~~ Batch_contents (mapfst_Batch A A&#39; f b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (vcons (length_Batch b) a (Batch_contents b)) ~~
vcons (length_Batch (mapfst_Batch A A&#39; f b)) (f a)
  (Batch_contents (mapfst_Batch A A&#39; f b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkaa" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkaa"><span class="nb">rewrite</span> map_Vector_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map f (Batch_contents b) ~~ Batch_contents (mapfst_Batch A A&#39; f b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons (length_Batch b) (f a)
  (map f (Batch_contents b)) ~~
vcons (length_Batch (mapfst_Batch A A&#39; f b)) (f a)
  (Batch_contents (mapfst_Batch A A&#39; f b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkab" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkab"><span class="nb">apply</span> vcons_sim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map f (Batch_contents b) ~~ Batch_contents (mapfst_Batch A A&#39; f b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_contents b) ~~
Batch_contents (mapfst_Batch A A&#39; f b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Lemmas regarding &lt;&lt;Batch_make&gt;&gt; *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">Batch_replace</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkac" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkac"><span class="kn">Lemma</span> <span class="nf">Batch_replace_sim1</span>
            `(b: Batch A B C)
            `{v1: Vector (length_Batch b) A&#39;}
            `{v2: Vector (length_Batch b) A&#39;}
            (Hsim: v1 ~~ v2):
      Batch_replace_contents b v1 = Batch_replace_contents b v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b v1 =
Batch_replace_contents b v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkad" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkad"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b v1 =
Batch_replace_contents b v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkae" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkae"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) v1 =
Batch_replace_contents (Done c) v2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chkaf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) A&#39;,
v1 ~~ v2 -&gt;
Batch_replace_contents b v1 =
Batch_replace_contents b v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chkaf"><hr></label><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a) v1 =
Batch_replace_contents (b ‚ßÜ a) v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb0">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) v1 =
Batch_replace_contents (Done c) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb1">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) A&#39;,
v1 ~~ v2 -&gt;
Batch_replace_contents b v1 =
Batch_replace_contents b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a) v1 =
Batch_replace_contents (b ‚ßÜ a) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb2"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">rewrite</span> Batch_replace_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) A&#39;,
v1 ~~ v2 -&gt;
Batch_replace_contents b v1 =
Batch_replace_contents b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v1) ‚ßÜ Vector_hd v1 =
Batch_replace_contents b (Vector_tl v2) ‚ßÜ Vector_hd v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb3"><span class="nb">rewrite</span> (IHb _ _ (Vector_tl_sim Hsim)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) A&#39;,
v1 ~~ v2 -&gt;
Batch_replace_contents b v1 =
Batch_replace_contents b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v2) ‚ßÜ Vector_hd v1 =
Batch_replace_contents b (Vector_tl v2) ‚ßÜ Vector_hd v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb4"><span class="nb">rewrite</span> (Vector_hd_sim Hsim).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b) A&#39;,
v1 ~~ v2 -&gt;
Batch_replace_contents b v1 =
Batch_replace_contents b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v2) ‚ßÜ Vector_hd v2 =
Batch_replace_contents b (Vector_tl v2) ‚ßÜ Vector_hd v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb5"><span class="kn">Lemma</span> <span class="nf">Batch_replace_sim2</span>
            `(b1: Batch A B C)
            `(b2: Batch A B C)
            `{v1: Vector (length_Batch b1) A&#39;}
            `{v2: Vector (length_Batch b2) A&#39;}
            (Heq: b1 = b2)
            (Hsim: Vector_sim v1 v2):
      Batch_replace_contents b1 v1 = Batch_replace_contents b2 v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>b1 = b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b1 v1 =
Batch_replace_contents b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>b1 = b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b1 v1 =
Batch_replace_contents b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> (<span class="nb">subst</span>; <span class="nb">apply</span> Batch_replace_sim1).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb7"><span class="kn">Lemma</span> <span class="nf">Batch_replace_sim3</span>
            `(b1: Batch A1 B C)
            `(b2: Batch A2 B C)
            `{v1: Vector (length_Batch b1) A&#39;}
            `{v2: Vector (length_Batch b2) A&#39;}
            (Heq: shape b1 = shape b2)
            (Hsim: v1 ~~ v2):
      Batch_replace_contents b1 v1 = Batch_replace_contents b2 v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b1 v1 =
Batch_replace_contents b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b1 v1 =
Batch_replace_contents b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Vector_fun_sim_eq;
        <span class="nb">auto using</span> Batch_replace_shape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkb9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkb9"><span class="kn">Lemma</span> <span class="nf">length_replace_contents</span>:
      <span class="kr">forall</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>: <span class="kt">Type</span>} (<span class="nv">b</span>: Batch A B C) `(v: Vector _ A&#39;),
        length_Batch b = length_Batch (Batch_replace_contents b v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">A&#39;</span> : <span class="kt">Type</span>)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
length_Batch b =
length_Batch (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkba" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkba"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">A&#39;</span> : <span class="kt">Type</span>)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
length_Batch b =
length_Batch (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkbb" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkbb"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch b =
length_Batch (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkbc" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkbc"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) =
length_Batch (Batch_replace_contents (Done c) v)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chkbd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
length_Batch b = length_Batch (Batch_replace_contents b v)</span></span></span><br></div><label class="goal-separator" for="batch-v-chkbd"><hr></label><div class="goal-conclusion">length_Batch (b ‚ßÜ a) =
length_Batch (Batch_replace_contents (b ‚ßÜ a) v)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkbe" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkbe">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) =
length_Batch (Batch_replace_contents (Done c) v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkbf" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkbf">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
length_Batch b = length_Batch (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b ‚ßÜ a) =
length_Batch (Batch_replace_contents (b ‚ßÜ a) v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc0"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
length_Batch b = length_Batch (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (length_Batch b) =
S
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc1">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
length_Batch b = length_Batch (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch b =
length_Batch (Batch_replace_contents b (Vector_tl v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> (IHb (Vector_tl v)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc2"><span class="kn">Lemma</span> <span class="nf">Batch_shape_replace_contents</span>:
      <span class="kr">forall</span> {<span class="nv">A</span> <span class="nv">A&#39;</span> <span class="nv">B</span> <span class="nv">C</span>: <span class="kt">Type</span>} (<span class="nv">b</span>: Batch A B C) `(v: Vector _ A&#39;),
        shape b = shape (Batch_replace_contents b v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">A&#39;</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
shape b = shape (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">A&#39;</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
shape b = shape (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc4"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b = shape (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc5"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) =
shape (Batch_replace_contents (Done c) v)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chkc6" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
shape b = shape (Batch_replace_contents b v)</span></span></span><br></div><label class="goal-separator" for="batch-v-chkc6"><hr></label><div class="goal-conclusion">shape (b ‚ßÜ a) =
shape (Batch_replace_contents (b ‚ßÜ a) v)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) =
shape (Batch_replace_contents (Done c) v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
shape b = shape (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (b ‚ßÜ a) =
shape (Batch_replace_contents (b ‚ßÜ a) v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkc9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkc9"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
shape b = shape (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b ‚ßÜ const tt a =
mapfst_Batch A&#39; unit (const tt)
  (Batch_replace_contents b (Vector_tl v))
‚ßÜ const tt (Vector_hd v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkca" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkca">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
shape b = shape (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b =
mapfst_Batch A&#39; unit (const tt)
  (Batch_replace_contents b (Vector_tl v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> (IHb (Vector_tl v)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">Batch_replace</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Lens-like laws *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">lens_laws</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span> {<span class="nv">A</span> <span class="nv">A&#39;</span> <span class="nv">A&#39;&#39;</span> <span class="nv">B</span> <span class="nv">C</span>: <span class="kt">Type</span>}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkcb" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkcb"><span class="kn">Lemma</span> <span class="nf">Batch_make_contents</span>:
      <span class="kr">forall</span> (<span class="nv">b</span>: Batch A A C),
        Batch_make b (Batch_contents b) = extract_Batch b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A A C,
Batch_make b (Batch_contents b) = extract_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkcc" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkcc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A A C,
Batch_make b (Batch_contents b) = extract_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkcd" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkcd"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b (Batch_contents b) = extract_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkce" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkce"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Done c) (Batch_contents (Done c)) =
extract_Batch (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chkcf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make b (Batch_contents b) = extract_Batch b</span></span></span><br></div><label class="goal-separator" for="batch-v-chkcf"><hr></label><div class="goal-conclusion">Batch_make (b ‚ßÜ a) (Batch_contents (b ‚ßÜ a)) =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd0">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Done c) (Batch_contents (Done c)) =
extract_Batch (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd1">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make b (Batch_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (b ‚ßÜ a) (Batch_contents (b ‚ßÜ a)) =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd2"><span class="nb">rewrite</span> Batch_make_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make b (Batch_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b (Vector_tl (Batch_contents (b ‚ßÜ a)))
  (Vector_hd (Batch_contents (b ‚ßÜ a))) =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd3"><span class="nb">rewrite</span> Batch_contents_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make b (Batch_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b
  (Vector_tl
     (vcons (length_Batch b) a (Batch_contents b)))
  (Vector_hd
     (vcons (length_Batch b) a (Batch_contents b))) =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd4"><span class="nb">rewrite</span> Vector_tl_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make b (Batch_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b (Batch_contents b)
  (Vector_hd
     (vcons (length_Batch b) a (Batch_contents b))) =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd5"><span class="nb">rewrite</span> Vector_hd_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make b (Batch_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b (Batch_contents b) a =
extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd6"><span class="nb">rewrite</span> IHb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A A (A -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make b (Batch_contents b) = extract_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">extract_Batch b a = extract_Batch (b ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd7"><span class="kn">Lemma</span> <span class="nf">Batch_get_put</span>:
      <span class="kr">forall</span> (<span class="nv">b</span>: Batch A B C),
        Batch_replace_contents b (Batch_contents b) = b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A B C,
Batch_replace_contents b (Batch_contents b) = b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A B C,
Batch_replace_contents b (Batch_contents b) = b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkd9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkd9"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Batch_contents b) = b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkda" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkda"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c)
  (Batch_contents (Done c)) = Done c</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chkdb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Batch_contents b) = b</span></span></span><br></div><label class="goal-separator" for="batch-v-chkdb"><hr></label><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a)
  (Batch_contents (b ‚ßÜ a)) = b ‚ßÜ a</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkdc" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkdc">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c)
  (Batch_contents (Done c)) = Done c</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkdd" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkdd">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Batch_contents b) = b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a)
  (Batch_contents (b ‚ßÜ a)) = b ‚ßÜ a</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkde" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkde"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Batch_contents b) = b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b
  (Vector_tl
     (vcons (length_Batch b) a (Batch_contents b)))
‚ßÜ Vector_hd
    (vcons (length_Batch b) a (Batch_contents b)) =
b ‚ßÜ a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkdf" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkdf"><span class="nb">rewrite</span> Vector_tl_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Batch_contents b) = b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Batch_contents b)
‚ßÜ Vector_hd
    (vcons (length_Batch b) a (Batch_contents b)) =
b ‚ßÜ a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke0"><span class="nb">rewrite</span> Vector_hd_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Batch_contents b) = b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Batch_contents b) ‚ßÜ a =
b ‚ßÜ a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke1"><span class="nb">rewrite</span> IHb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Batch_contents b) = b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">b ‚ßÜ a = b ‚ßÜ a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke2"><span class="kn">Lemma</span> <span class="nf">Batch_put_get</span>:
      <span class="kr">forall</span> (<span class="nv">b</span>: Batch A B C) (<span class="nv">v</span>: Vector (length_Batch b) A&#39;),
        Batch_contents (Batch_replace_contents b v) =
          coerce length_replace_contents b v <span class="kr">in</span> v.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
Batch_contents (Batch_replace_contents b v) =
coerce length_replace_contents b v <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
Batch_contents (Batch_replace_contents b v) =
coerce length_replace_contents b v <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke4"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (Batch_replace_contents b v) =
coerce length_replace_contents b v <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke5"><span class="nb">generalize</span> (length_replace_contents b v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span>
  <span class="nv">e</span> : length_Batch b =
      length_Batch (Batch_replace_contents b v),
Batch_contents (Batch_replace_contents b v) =
coerce e <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke6"><span class="nb">intros</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch b = length_Batch (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (Batch_replace_contents b v) =
coerce Heq <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke7"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (Batch_replace_contents (Done c) v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (Batch_replace_contents (Done c) v) =
coerce Heq <span class="kr">in</span> v</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chke8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (Batch_replace_contents (b ‚ßÜ a) v)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (Batch_replace_contents b v)),
Batch_contents (Batch_replace_contents b v) = coerce Heq <span class="kr">in</span> v</span></span></span><br></div><label class="goal-separator" for="batch-v-chke8"><hr></label><div class="goal-conclusion">Batch_contents (Batch_replace_contents (b ‚ßÜ a) v) =
coerce Heq <span class="kr">in</span> v</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chke9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chke9">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (Batch_replace_contents (Done c) v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (Batch_replace_contents (Done c) v) =
coerce Heq <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkea" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkea"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (Batch_replace_contents (Done c) v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vnil = coerce Heq <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkeb" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkeb"><span class="nb">symmetry</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (Batch_replace_contents (Done c) v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">coerce Heq <span class="kr">in</span> v = vnil</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Vector_nil_eq.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkec" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkec">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (Batch_replace_contents (b ‚ßÜ a) v)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (Batch_replace_contents b v)),
Batch_contents (Batch_replace_contents b v) = coerce Heq <span class="kr">in</span> v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents (Batch_replace_contents (b ‚ßÜ a) v) =
coerce Heq <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chked" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chked"><span class="nb">cbn</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (Batch_replace_contents b v)),
Batch_contents (Batch_replace_contents b v) = coerce Heq <span class="kr">in</span> v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v)
  (Batch_contents
     (Batch_replace_contents b (Vector_tl v))) =
coerce Heq <span class="kr">in</span> v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkee" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkee"><span class="nb">rewrite</span> Vector_surjective_pairing2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (Batch_replace_contents b v)),
Batch_contents (Batch_replace_contents b v) = coerce Heq <span class="kr">in</span> v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v)
  (Batch_contents
     (Batch_replace_contents b (Vector_tl v))) =
vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd (coerce Heq <span class="kr">in</span> v))
  (Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkef" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkef"><span class="nb">rewrite</span> &lt;- (Vector_hd_coerce_eq (Heq := Heq) (v := v)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (Batch_replace_contents b v)),
Batch_contents (Batch_replace_contents b v) = coerce Heq <span class="kr">in</span> v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v)
  (Batch_contents
     (Batch_replace_contents b (Vector_tl v))) =
vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v) (Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf0"><span class="nb">specialize</span> (IHb (Vector_tl v) (S_uncons Heq)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_contents (Batch_replace_contents b (Vector_tl v)) =
coerce S_uncons Heq <span class="kr">in</span> Vector_tl v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v)
  (Batch_contents
     (Batch_replace_contents b (Vector_tl v))) =
vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v) (Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf1"><span class="nb">fold</span> (@length_Batch A B).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_contents (Batch_replace_contents b (Vector_tl v)) =
coerce S_uncons Heq <span class="kr">in</span> Vector_tl v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v)
  (Batch_contents
     (Batch_replace_contents b (Vector_tl v))) =
vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v) (Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        <span class="c">(* ^^ I have no idea why this got expanded but it blocks rewriting *)</span>
</span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf2"><span class="nb">rewrite</span> IHb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_contents (Batch_replace_contents b (Vector_tl v)) =
coerce S_uncons Heq <span class="kr">in</span> Vector_tl v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v) (coerce S_uncons Heq <span class="kr">in</span> Vector_tl v) =
vcons
  (length_Batch
     (Batch_replace_contents b (Vector_tl v)))
  (Vector_hd v) (Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf3">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_contents (Batch_replace_contents b (Vector_tl v)) =
coerce S_uncons Heq <span class="kr">in</span> Vector_tl v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">coerce S_uncons Heq <span class="kr">in</span> Vector_tl v =
Vector_tl (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf4"><span class="nb">apply</span> Vector_sim_eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (S (length_Batch b)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>S (length_Batch b) =
S (length_Batch (Batch_replace_contents b (Vector_tl v)))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_contents (Batch_replace_contents b (Vector_tl v)) =
coerce S_uncons Heq <span class="kr">in</span> Vector_tl v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">coerce S_uncons Heq <span class="kr">in</span> Vector_tl v ~~
Vector_tl (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input">vector_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf5"><span class="kn">Lemma</span> <span class="nf">Batch_put_put</span>:
      <span class="kr">forall</span> (<span class="nv">b</span>: Batch A B C)
        (<span class="nv">v1</span>: Vector (length_Batch b) A&#39;)
        (<span class="nv">v2</span>: Vector (length_Batch b) A&#39;&#39;),
        Batch_replace_contents
          (Batch_replace_contents b v1)
          (coerce (length_replace_contents b v1) <span class="kr">in</span> v2) =
          Batch_replace_contents b v2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v1</span> : Vector (length_Batch b) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch b) A&#39;&#39;),
Batch_replace_contents (Batch_replace_contents b v1)
  (coerce length_replace_contents b v1 <span class="kr">in</span> v2) =
Batch_replace_contents b v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v1</span> : Vector (length_Batch b) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch b) A&#39;&#39;),
Batch_replace_contents (Batch_replace_contents b v1)
  (coerce length_replace_contents b v1 <span class="kr">in</span> v2) =
Batch_replace_contents b v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf7"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Batch_replace_contents b v1)
  (coerce length_replace_contents b v1 <span class="kr">in</span> v2) =
Batch_replace_contents b v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkf8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkf8"><span class="nb">apply</span> Batch_replace_sim3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Batch_replace_contents b v1) = shape b</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chkf9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;&#39;</span></span></span><br></div><label class="goal-separator" for="batch-v-chkf9"><hr></label><div class="goal-conclusion">coerce length_replace_contents b v1 <span class="kr">in</span> v2 ~~ v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkfa" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkfa"><span class="nb">symmetry</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b = shape (Batch_replace_contents b v1)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chkfb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;&#39;</span></span></span><br></div><label class="goal-separator" for="batch-v-chkfb"><hr></label><div class="goal-conclusion">coerce length_replace_contents b v1 <span class="kr">in</span> v2 ~~ v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkfc" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkfc"><span class="nb">apply</span> Batch_shape_replace_contents.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">coerce length_replace_contents b v1 <span class="kr">in</span> v2 ~~ v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input">vector_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkfd" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkfd"><span class="kn">Lemma</span> <span class="nf">Batch_replace_spec</span>:
      <span class="kr">forall</span> (<span class="nv">b</span>: Batch A B C),
        Batch_replace_contents b =
          precoerce (length_cojoin_Batch b)
                   <span class="kr">in</span> Batch_make (cojoin_Batch b (B := A&#39;)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A B C,
Batch_replace_contents b =
Batch_make (cojoin_Batch b)
‚óã coerce_Vector_length (length_cojoin_Batch b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkfe" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkfe"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">b</span> : Batch A B C,
Batch_replace_contents b =
Batch_make (cojoin_Batch b)
‚óã coerce_Vector_length (length_cojoin_Batch b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chkff" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chkff"><span class="nb">intros</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b =
Batch_make (cojoin_Batch b)
‚óã coerce_Vector_length (length_cojoin_Batch b)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk100" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk100">ext v.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b v =
Batch_make (cojoin_Batch b)
  (coerce length_cojoin_Batch b <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk101" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk101"><span class="nb">generalize</span> (length_cojoin_Batch (A&#39; := A&#39;) b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span>
  <span class="nv">e</span> : length_Batch b = length_Batch (cojoin_Batch b),
Batch_replace_contents b v =
Batch_make (cojoin_Batch b) (coerce e <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk102" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk102"><span class="nb">intros</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch b = length_Batch (cojoin_Batch b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b v =
Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk103" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk103"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (cojoin_Batch (Done c))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) v =
Batch_make (cojoin_Batch (Done c)) (coerce Heq <span class="kr">in</span> v)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk104" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (cojoin_Batch b)),
Batch_replace_contents b v = Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk104"><hr></label><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a) v =
Batch_make (cojoin_Batch (b ‚ßÜ a)) (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk105" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk105">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (cojoin_Batch (Done c))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) v =
Batch_make (cojoin_Batch (Done c)) (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk106" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk106">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (cojoin_Batch b)),
Batch_replace_contents b v = Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b ‚ßÜ a) v =
Batch_make (cojoin_Batch (b ‚ßÜ a)) (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk107" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk107"><span class="nb">rewrite</span> Batch_replace_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (cojoin_Batch b)),
Batch_replace_contents b v = Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v) ‚ßÜ Vector_hd v =
Batch_make (cojoin_Batch (b ‚ßÜ a)) (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk108" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk108"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (cojoin_Batch b)),
Batch_replace_contents b v = Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v) ‚ßÜ Vector_hd v =
Batch_make (map Step (cojoin_Batch b))
  (Vector_tl (coerce Heq <span class="kr">in</span> v))
  (Vector_hd (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk109" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk109"><span class="nb">rewrite</span> Batch_make_compose_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (cojoin_Batch b)),
Batch_replace_contents b v = Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v) ‚ßÜ Vector_hd v =
Batch_make (cojoin_Batch b)
  (coerce eq_sym
            (batch_length_map Step (cojoin_Batch b))
   <span class="kr">in</span> Vector_tl (coerce Heq <span class="kr">in</span> v))
‚ßÜ Vector_hd (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk10a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk10a"><span class="nb">rewrite</span> &lt;- (Vector_hd_coerce_eq (Heq := Heq)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (cojoin_Batch b)),
Batch_replace_contents b v = Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v) ‚ßÜ Vector_hd v =
Batch_make (cojoin_Batch b)
  (coerce eq_sym
            (batch_length_map Step (cojoin_Batch b))
   <span class="kr">in</span> Vector_tl (coerce Heq <span class="kr">in</span> v)) ‚ßÜ Vector_hd v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk10b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk10b">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">Heq</span> : length_Batch b = length_Batch (cojoin_Batch b)),
Batch_replace_contents b v = Batch_make (cojoin_Batch b) (coerce Heq <span class="kr">in</span> v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v) =
Batch_make (cojoin_Batch b)
  (coerce eq_sym
            (batch_length_map Step (cojoin_Batch b))
   <span class="kr">in</span> Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk10c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk10c"><span class="nb">specialize</span> (IHb (Vector_tl v) (length_cojoin_Batch b)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Vector_tl v) =
Batch_make (cojoin_Batch b) (coerce length_cojoin_Batch b <span class="kr">in</span> Vector_tl v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b (Vector_tl v) =
Batch_make (cojoin_Batch b)
  (coerce eq_sym
            (batch_length_map Step (cojoin_Batch b))
   <span class="kr">in</span> Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk10d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk10d"><span class="nb">rewrite</span> IHb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Vector_tl v) =
Batch_make (cojoin_Batch b) (coerce length_cojoin_Batch b <span class="kr">in</span> Vector_tl v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (cojoin_Batch b)
  (coerce length_cojoin_Batch b <span class="kr">in</span> Vector_tl v) =
Batch_make (cojoin_Batch b)
  (coerce eq_sym
            (batch_length_map Step (cojoin_Batch b))
   <span class="kr">in</span> Vector_tl (coerce Heq <span class="kr">in</span> v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk10e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk10e"><span class="nb">apply</span> Batch_make_sim1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length_Batch (b ‚ßÜ a) = length_Batch (cojoin_Batch (b ‚ßÜ a))</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b (Vector_tl v) =
Batch_make (cojoin_Batch b) (coerce length_cojoin_Batch b <span class="kr">in</span> Vector_tl v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">coerce length_cojoin_Batch b <span class="kr">in</span> Vector_tl v ~~
coerce eq_sym (batch_length_map Step (cojoin_Batch b))
<span class="kr">in</span> Vector_tl (coerce Heq <span class="kr">in</span> v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input">vector_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk10f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk10f"><span class="kn">Lemma</span> <span class="nf">Batch_make_replace_contents</span>:
      <span class="kr">forall</span> (<span class="nv">b</span>: Batch A B C) (<span class="nv">v</span>: Vector (length_Batch b) A&#39;),
        Batch_make (Batch_replace_contents b v) =
          precoerce (eq_sym (length_replace_contents b v))
        <span class="kr">in</span> (Batch_make (B := B) b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
Batch_make (Batch_replace_contents b v) =
Batch_make b
‚óã coerce_Vector_length
    (eq_sym (length_replace_contents b v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk110" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk110"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B C)
  (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
Batch_make (Batch_replace_contents b v) =
Batch_make b
‚óã coerce_Vector_length
    (eq_sym (length_replace_contents b v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk111" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk111"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b v) =
Batch_make b
‚óã coerce_Vector_length
    (eq_sym (length_replace_contents b v))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk112" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk112">ext v&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch (Batch_replace_contents b v)) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b v) v&#39; =
Batch_make b
  (coerce eq_sym (length_replace_contents b v) <span class="kr">in</span> v&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk113" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk113"><span class="nb">generalize</span> (eq_sym (length_replace_contents b v)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch (Batch_replace_contents b v)) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span>
  <span class="nv">e</span> : length_Batch (Batch_replace_contents b v) =
      length_Batch b,
Batch_make (Batch_replace_contents b v) v&#39; =
Batch_make b (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk114" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk114"><span class="nb">intro</span> e.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch (Batch_replace_contents b v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents b v) =
length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b v) v&#39; =
Batch_make b (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk115" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk115"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (Done c) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (Done c) v) =
length_Batch (Done c)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents (Done c) v) v&#39; =
Batch_make (Done c) (coerce e <span class="kr">in</span> v&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk116" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">v&#39;</span> : Vector (length_Batch (Batch_replace_contents b v)) B)
(<span class="nv">e</span> : length_Batch (Batch_replace_contents b v) = length_Batch b),
Batch_make (Batch_replace_contents b v) v&#39; = Batch_make b (coerce e <span class="kr">in</span> v&#39;)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk116"><hr></label><div class="goal-conclusion">Batch_make (Batch_replace_contents (b ‚ßÜ a) v) v&#39; =
Batch_make (b ‚ßÜ a) (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk117" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk117">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (Done c) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (Done c) v) =
length_Batch (Done c)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents (Done c) v) v&#39; =
Batch_make (Done c) (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk118" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk118">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">v&#39;</span> : Vector (length_Batch (Batch_replace_contents b v)) B)
(<span class="nv">e</span> : length_Batch (Batch_replace_contents b v) = length_Batch b),
Batch_make (Batch_replace_contents b v) v&#39; = Batch_make b (coerce e <span class="kr">in</span> v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents (b ‚ßÜ a) v) v&#39; =
Batch_make (b ‚ßÜ a) (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk119" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk119"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Vector (length_Batch b) A&#39;)
(<span class="nv">v&#39;</span> : Vector (length_Batch (Batch_replace_contents b v)) B)
(<span class="nv">e</span> : length_Batch (Batch_replace_contents b v) = length_Batch b),
Batch_make (Batch_replace_contents b v) v&#39; = Batch_make b (coerce e <span class="kr">in</span> v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b (Vector_tl v))
  (Vector_tl v&#39;) (Vector_hd v&#39;) =
Batch_make b (Vector_tl (coerce e <span class="kr">in</span> v&#39;))
  (Vector_hd (coerce e <span class="kr">in</span> v&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk11a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk11a"><span class="nb">specialize</span> (IHb (Vector_tl v) (Vector_tl v&#39;)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span>
<span class="nv">e</span> : length_Batch (Batch_replace_contents b (Vector_tl v)) = length_Batch b,
Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b (coerce e <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b (Vector_tl v))
  (Vector_tl v&#39;) (Vector_hd v&#39;) =
Batch_make b (Vector_tl (coerce e <span class="kr">in</span> v&#39;))
  (Vector_hd (coerce e <span class="kr">in</span> v&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk11b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk11b"><span class="nb">specialize</span> (IHb (eq_sym (length_replace_contents b (Vector_tl v)))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b (Vector_tl v))
  (Vector_tl v&#39;) (Vector_hd v&#39;) =
Batch_make b (Vector_tl (coerce e <span class="kr">in</span> v&#39;))
  (Vector_hd (coerce e <span class="kr">in</span> v&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk11c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk11c"><span class="nb">replace</span> (Vector_hd (coerce_Vector_length e v&#39;))
          <span class="kr">with</span> (Vector_hd v&#39;) <span class="nb">at</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b (Vector_tl v))
  (Vector_tl v&#39;) (Vector_hd v&#39;) =
Batch_make b (Vector_tl (coerce e <span class="kr">in</span> v&#39;))
  (Vector_hd v&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk11d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk11d"><hr></label><div class="goal-conclusion">Vector_hd v&#39; = Vector_hd (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk11e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk11e"><span class="kn">Set Keyed Unification</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (Batch_replace_contents b (Vector_tl v))
  (Vector_tl v&#39;) (Vector_hd v&#39;) =
Batch_make b (Vector_tl (coerce e <span class="kr">in</span> v&#39;))
  (Vector_hd v&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk11f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk11f"><hr></label><div class="goal-conclusion">Vector_hd v&#39; = Vector_hd (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk120" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk120"><span class="nb">rewrite</span> IHb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b
  (coerce eq_sym
            (length_replace_contents b (Vector_tl v))
   <span class="kr">in</span> Vector_tl v&#39;) (Vector_hd v&#39;) =
Batch_make b (Vector_tl (coerce e <span class="kr">in</span> v&#39;))
  (Vector_hd v&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk121" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk121"><hr></label><div class="goal-conclusion">Vector_hd v&#39; = Vector_hd (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk122" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk122"><span class="kn">Unset Keyed Unification</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b
  (coerce eq_sym
            (length_replace_contents b (Vector_tl v))
   <span class="kr">in</span> Vector_tl v&#39;) (Vector_hd v&#39;) =
Batch_make b (Vector_tl (coerce e <span class="kr">in</span> v&#39;))
  (Vector_hd v&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk123" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk123"><hr></label><div class="goal-conclusion">Vector_hd v&#39; = Vector_hd (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk124" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk124">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">coerce eq_sym
         (length_replace_contents b (Vector_tl v))
<span class="kr">in</span> Vector_tl v&#39; = Vector_tl (coerce e <span class="kr">in</span> v&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk125" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk125"><hr></label><div class="goal-conclusion">Vector_hd v&#39; = Vector_hd (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk126" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk126">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">coerce eq_sym
         (length_replace_contents b (Vector_tl v))
<span class="kr">in</span> Vector_tl v&#39; = Vector_tl (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk127" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk127"><span class="nb">apply</span> Vector_eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">proj1_sig
  (coerce eq_sym
            (length_replace_contents b (Vector_tl v))
   <span class="kr">in</span> Vector_tl v&#39;) =
proj1_sig (Vector_tl (coerce e <span class="kr">in</span> v&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk128" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk128"><span class="nb">rewrite</span> &lt;- coerce_Vector_contents.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">proj1_sig (Vector_tl v&#39;) =
proj1_sig (Vector_tl (coerce e <span class="kr">in</span> v&#39;))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Vector_tl_coerce_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk129" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk129">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, A', A'', B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector
  (length_Batch
     (Batch_replace_contents (b ‚ßÜ a) v)) B</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>length_Batch (Batch_replace_contents (b ‚ßÜ a) v) =
length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>Batch_make (Batch_replace_contents b (Vector_tl v)) (Vector_tl v&#39;) =
Batch_make b
(coerce eq_sym (length_replace_contents b (Vector_tl v)) <span class="kr">in</span> Vector_tl v&#39;)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Vector_hd v&#39; = Vector_hd (coerce e <span class="kr">in</span> v&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Vector_hd_coerce_eq.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">lens_laws</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Relating make and shape *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">make_shape</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk12a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk12a"><span class="kn">Lemma</span> <span class="nf">Batch_make_shape_rev</span>:
      <span class="kr">forall</span> `(b1: Batch A B C) `(b2: Batch A2 B C),
        Batch_make b1 ~!~ Batch_make b2 -&gt;
        shape b1 = shape b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
Batch_make b1 ~!~ Batch_make b2 -&gt; shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk12b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk12b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
Batch_make b1 ~!~ Batch_make b2 -&gt; shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk12c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk12c"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk12d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk12d"><span class="nb">unfold</span> Vector_fun_sim <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length_Batch b1 = length_Batch b2 /\
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt; Batch_make b1 v1 = Batch_make b2 v2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk12e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk12e"><span class="nb">destruct</span> H <span class="kr">as</span> [Hlen Hsim].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch b1 = length_Batch b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
  (<span class="nv">v2</span> : Vector (length_Batch b2) B),
v1 ~~ v2 -&gt; Batch_make b1 v1 = Batch_make b2 v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b1 = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk12f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk12f"><span class="nb">induction</span> b1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch b2) B),
v1 ~~ v2 -&gt;
Batch_make (Done c) v1 = Batch_make b2 v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) = shape b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk130" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch b2) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 = Batch_make b2 v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk130"><hr></label><div class="goal-conclusion">shape (b1 ‚ßÜ a) = shape b2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk131" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk131">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch b2) B),
v1 ~~ v2 -&gt;
Batch_make (Done c) v1 = Batch_make b2 v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk132" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk132"><span class="nb">destruct</span> b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (Done c0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (Done c0)) B),
v1 ~~ v2 -&gt;
Batch_make (Done c) v1 =
Batch_make (Done c0) v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) = shape (Done c0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk133" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (b2 ‚ßÜ a)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a)) B),
v1 ~~ v2 -&gt;
Batch_make (Done c) v1 = Batch_make (b2 ‚ßÜ a) v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk133"><hr></label><div class="goal-conclusion">shape (Done c) = shape (b2 ‚ßÜ a)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk134" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk134">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (Done c0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (Done c0)) B),
v1 ~~ v2 -&gt;
Batch_make (Done c) v1 =
Batch_make (Done c0) v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) = shape (Done c0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk135" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk135"><span class="nb">cbn</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> = <span class="mi">0</span></span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector <span class="mi">0</span> B, v1 ~~ v2 -&gt; c = c0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Done c = Done c0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk136" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk136"><span class="nb">specialize</span> (Hsim vnil vnil <span class="kp">ltac</span>:(<span class="bp">reflexivity</span>)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> = <span class="mi">0</span></span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>c = c0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Done c = Done c0</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">inversion</span> Hsim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk137" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk137">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (Done c) = length_Batch (b2 ‚ßÜ a)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (Done c)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a)) B),
v1 ~~ v2 -&gt;
Batch_make (Done c) v1 = Batch_make (b2 ‚ßÜ a) v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (Done c) = shape (b2 ‚ßÜ a)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">false.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk138" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk138">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch b2</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch b2) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 = Batch_make b2 v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (b1 ‚ßÜ a) = shape b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk139" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk139"><span class="nb">destruct</span> b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (Done c)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (Done c)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 = Batch_make (Done c) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (b1 ‚ßÜ a) = shape (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk13a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk13a"><hr></label><div class="goal-conclusion">shape (b1 ‚ßÜ a) = shape (b2 ‚ßÜ a0)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk13b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk13b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (Done c)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (Done c)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 = Batch_make (Done c) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (b1 ‚ßÜ a) = shape (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">false.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk13c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk13c">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape (b1 ‚ßÜ a) = shape (b2 ‚ßÜ a0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk13d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk13d"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b1 ‚ßÜ const tt a =
mapfst_Batch A2 unit (const tt) b2 ‚ßÜ const tt a0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk13e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk13e">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mapfst_Batch A unit (const tt) b1 =
mapfst_Batch A2 unit (const tt) b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk13f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk13f"><span class="nb">apply</span> IHb1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch b1 = length_Batch b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk140" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk140"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
  (<span class="nv">v2</span> : Vector (length_Batch b2) B),
v1 ~~ v2 -&gt; Batch_make b1 v1 = Batch_make b2 v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk141" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk141">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch b1 = length_Batch b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">inversion</span> Hlen.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk142" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk142">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
  (<span class="nv">v2</span> : Vector (length_Batch b2) B),
v1 ~~ v2 -&gt; Batch_make b1 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk143" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk143"><span class="nb">intros</span> v1 v2 Vsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk144" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk144">ext b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 b = Batch_make b2 v2 b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk145" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk145"><span class="nb">assert</span> (Vsim&#39;: vcons _ b v1 ~~ vcons _ b v2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">vcons (length_Batch b1) b v1 ~~
vcons (length_Batch b2) b v2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk146" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Vsim'</var><span class="hyp-type"><b>: </b><span>vcons (length_Batch b1) b v1 ~~
vcons (length_Batch b2) b v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk146"><hr></label><div class="goal-conclusion">Batch_make b1 v1 b = Batch_make b2 v2 b</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk147" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk147"><span class="bp">now</span> <span class="nb">apply</span> vcons_sim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b1 ‚ßÜ a)) B)
  (<span class="nv">v2</span> : Vector (length_Batch (b2 ‚ßÜ a0)) B),
v1 ~~ v2 -&gt;
Batch_make (b1 ‚ßÜ a) v1 =
Batch_make (b2 ‚ßÜ a0) v2</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Vsim'</var><span class="hyp-type"><b>: </b><span>vcons (length_Batch b1) b v1 ~~
vcons (length_Batch b2) b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 b = Batch_make b2 v2 b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk148" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk148"><span class="nb">specialize</span> (Hsim _ _ Vsim&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make (b1 ‚ßÜ a)
  (vcons (length_Batch b1) b v1) =
Batch_make (b2 ‚ßÜ a0)
  (vcons (length_Batch b2) b v2)</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>Vsim'</var><span class="hyp-type"><b>: </b><span>vcons (length_Batch b1) b v1 ~~
vcons (length_Batch b2) b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 b = Batch_make b2 v2 b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk149" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk149"><span class="nb">cbn</span> <span class="kr">in</span> Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1
  (Vector_tl (vcons (length_Batch b1) b v1))
  (Vector_hd (vcons (length_Batch b1) b v1)) =
Batch_make b2
  (Vector_tl (vcons (length_Batch b2) b v2))
  (Vector_hd (vcons (length_Batch b2) b v2))</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>Vsim'</var><span class="hyp-type"><b>: </b><span>vcons (length_Batch b1) b v1 ~~
vcons (length_Batch b2) b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 b = Batch_make b2 v2 b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk14a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk14a"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">rewrite</span> Vector_tl_vcons <span class="kr">in</span> Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 v1
  (Vector_hd (vcons (length_Batch b1) b v1)) =
Batch_make b2 v2
  (Vector_hd (vcons (length_Batch b2) b v2))</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>Vsim'</var><span class="hyp-type"><b>: </b><span>vcons (length_Batch b1) b v1 ~~
vcons (length_Batch b2) b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 b = Batch_make b2 v2 b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk14b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk14b"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">rewrite</span> Vector_hd_vcons <span class="kr">in</span> Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C)</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch (b1 ‚ßÜ a) = length_Batch (b2 ‚ßÜ a0)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b1) B</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>Batch_make b1 v1 b = Batch_make b2 v2 b</span></span></span><br><span><var>IHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">b2</span> : Batch A2 B (B -&gt; C),
length_Batch b1 = length_Batch b2 -&gt;
(<span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b1) B)
   (<span class="nv">v2</span> : Vector (length_Batch b2) B),
 v1 ~~ v2 -&gt;
 Batch_make b1 v1 = Batch_make b2 v2) -&gt;
shape b1 = shape b2</span></span></span><br><span><var>Vsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br><span><var>Vsim'</var><span class="hyp-type"><b>: </b><span>vcons (length_Batch b1) b v1 ~~
vcons (length_Batch b2) b v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 v1 b = Batch_make b2 v2 b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk14c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk14c"><span class="kn">Corollary</span> <span class="nf">Batch_make_shape_iff</span>:
      <span class="kr">forall</span> `(b1: Batch A1 B C) `(b2: Batch A2 B C),
        shape b1 = shape b2 &lt;-&gt;
          Batch_make b1 ~!~ Batch_make b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 &lt;-&gt;
Batch_make b1 ~!~ Batch_make b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk14d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk14d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
shape b1 = shape b2 &lt;-&gt;
Batch_make b1 ~!~ Batch_make b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk14e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk14e"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b1 = shape b2 &lt;-&gt;
Batch_make b1 ~!~ Batch_make b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">split</span>; <span class="nb">auto using</span> Batch_make_shape,
        Batch_make_shape_rev.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk14f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk14f"><span class="kn">Lemma</span> <span class="nf">Batch_replace_sim_if_make</span>:
      <span class="kr">forall</span> `(b1: Batch A1 B C) `(b2: Batch A2 B C),
      Batch_make b1 ~!~ Batch_make b2 -&gt;
      <span class="kr">forall</span> <span class="nv">A&#39;</span>,
        Batch_replace_contents (A&#39; := A&#39;) b1 ~!~ Batch_replace_contents b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
Batch_make b1 ~!~ Batch_make b2 -&gt;
<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk150" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk150"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A1</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B C) (<span class="nv">A2</span> : <span class="kt">Type</span>)
  (<span class="nv">b2</span> : Batch A2 B C),
Batch_make b1 ~!~ Batch_make b2 -&gt;
<span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk151" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk151">introv Hshape.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk152" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk152"><span class="nb">rewrite</span> &lt;- Batch_make_shape_iff <span class="kr">in</span> Hshape.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">A&#39;</span> : <span class="kt">Type</span>,
Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk153" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk153"><span class="nb">intro</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b1 ~!~
Batch_replace_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk154" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk154"><span class="nb">apply</span> (Batch_shape_ind Hshape).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
Batch_replace_contents (Done c) ~!~
Batch_replace_contents (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk155" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><label class="goal-separator" for="batch-v-chk155"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
Batch_replace_contents b1 ~!~
Batch_replace_contents b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
Batch_replace_contents (b1 ‚ßÜ a1) ~!~
Batch_replace_contents (b2 ‚ßÜ a2)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk156" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk156">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">c</span> : C),
Batch_replace_contents (Done c) ~!~
Batch_replace_contents (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk157" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk157"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) ~!~
Batch_replace_contents (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk158" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk158"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) = length_Batch (Done c)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk159" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C0</span></span></span><br></div><label class="goal-separator" for="batch-v-chk159"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch (Done c)) A&#39;,
v1 ~~ v2 -&gt;
Batch_replace_contents (Done c) v1 =
Batch_replace_contents (Done c) v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk15a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk15a">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (Done c) = length_Batch (Done c)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk15b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk15b">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch (Done c)) A&#39;,
v1 ~~ v2 -&gt;
Batch_replace_contents (Done c) v1 =
Batch_replace_contents (Done c) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk15c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk15c"><span class="nb">intros</span> v1 v2 Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C0</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (Done c) v1 =
Batch_replace_contents (Done c) v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk15d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk15d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> : Batch A1 B (B -&gt; C))
  (<span class="nv">b2</span> : Batch A2 B (B -&gt; C)),
Batch_replace_contents b1 ~!~
Batch_replace_contents b2 -&gt;
<span class="kr">forall</span> (<span class="nv">a1</span> : A1) (<span class="nv">a2</span> : A2),
shape (b1 ‚ßÜ a1) = shape (b2 ‚ßÜ a2) -&gt;
Batch_replace_contents (b1 ‚ßÜ a1) ~!~
Batch_replace_contents (b2 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk15e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk15e"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b0 ‚ßÜ a1) ~!~
Batch_replace_contents (b3 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk15f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk15f"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b0 ‚ßÜ a1) = length_Batch (b3 ‚ßÜ a2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk160" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk160"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;),
v1 ~~ v2 -&gt;
Batch_replace_contents (b0 ‚ßÜ a1) v1 =
Batch_replace_contents (b3 ‚ßÜ a2) v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk161" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk161">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch (b0 ‚ßÜ a1) = length_Batch (b3 ‚ßÜ a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto using</span> length_Batch_shape.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk162" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk162">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;),
v1 ~~ v2 -&gt;
Batch_replace_contents (b0 ‚ßÜ a1) v1 =
Batch_replace_contents (b3 ‚ßÜ a2) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk163" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk163"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents (b0 ‚ßÜ a1) v1 =
Batch_replace_contents (b3 ‚ßÜ a2) v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk164" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk164"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b0 (Vector_tl v1)
‚ßÜ Vector_hd v1 =
Batch_replace_contents b3 (Vector_tl v2)
‚ßÜ Vector_hd v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk165" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk165">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b0 (Vector_tl v1) =
Batch_replace_contents b3 (Vector_tl v2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk166" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk166"><hr></label><div class="goal-conclusion">Vector_hd v1 = Vector_hd v2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk167" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk167">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b0 (Vector_tl v1) =
Batch_replace_contents b3 (Vector_tl v2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk168" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk168"><span class="nb">destruct</span> H <span class="kr">as</span> [Hlen Hsim].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch b0 = length_Batch b3</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b0) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch b3) A&#39;),
v1 ~~ v2 -&gt;
Batch_replace_contents b0 v1 =
Batch_replace_contents b3 v2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b0 (Vector_tl v1) =
Batch_replace_contents b3 (Vector_tl v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk169" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk169"><span class="nb">apply</span> Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>Hlen</var><span class="hyp-type"><b>: </b><span>length_Batch b0 = length_Batch b3</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v1</span> : Vector (length_Batch b0) A&#39;)
  (<span class="nv">v2</span> : Vector (length_Batch b3) A&#39;),
v1 ~~ v2 -&gt;
Batch_replace_contents b0 v1 =
Batch_replace_contents b3 v2</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Vector_tl v1 ~~ Vector_tl v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">            </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> Vector_tl_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk16a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk16a">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A1, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>Batch A1 B C</span></span></span><br><span><var>A2</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A2 B C</span></span></span><br><span><var>Hshape</var><span class="hyp-type"><b>: </b><span>shape b1 = shape b2</span></span></span><br><span><var>A', C0</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>Batch A1 B (B -&gt; C0)</span></span></span><br><span><var>b3</var><span class="hyp-type"><b>: </b><span>Batch A2 B (B -&gt; C0)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Batch_replace_contents b0 ~!~
Batch_replace_contents b3</span></span></span><br><span><var>a1</var><span class="hyp-type"><b>: </b><span>A1</span></span></span><br><span><var>a2</var><span class="hyp-type"><b>: </b><span>A2</span></span></span><br><span><var>Hshape0</var><span class="hyp-type"><b>: </b><span>shape (b0 ‚ßÜ a1) = shape (b3 ‚ßÜ a2)</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b0 ‚ßÜ a1)) A&#39;</span></span></span><br><span><var>v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b3 ‚ßÜ a2)) A&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Vector_hd v1 = Vector_hd v2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> Vector_hd_sim.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">make_shape</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Misc *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">spec</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk16b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk16b"><span class="kn">Lemma</span> <span class="nf">runBatch_const_contents</span>:
      <span class="kr">forall</span> `{Applicative G} `(b: Batch A B C)
        (x: G B) `(v: Vector _ A&#39;),
        runBatch G (const x) C b =
          runBatch G (const x) C
                   (Batch_replace_contents b v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">G</span> : <span class="kt">Type</span> -&gt; <span class="kt">Type</span>) (<span class="nv">H</span> : Map G) (<span class="nv">H0</span> : Pure G)
  (<span class="nv">H1</span> : Mult G),
Applicative G -&gt;
<span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">x</span> : G B)
  (<span class="nv">A&#39;</span> : <span class="kt">Type</span>) (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
runBatch G (const x) C b =
runBatch G (const x) C (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk16c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk16c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">G</span> : <span class="kt">Type</span> -&gt; <span class="kt">Type</span>) (<span class="nv">H</span> : Map G) (<span class="nv">H0</span> : Pure G)
  (<span class="nv">H1</span> : Mult G),
Applicative G -&gt;
<span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">x</span> : G B)
  (<span class="nv">A&#39;</span> : <span class="kt">Type</span>) (<span class="nv">v</span> : Vector (length_Batch b) A&#39;),
runBatch G (const x) C b =
runBatch G (const x) C (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk16d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk16d"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>G B</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">runBatch G (const x) C b =
runBatch G (const x) C (Batch_replace_contents b v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk16e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk16e"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>G B</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">runBatch G (const x) C (Done c) =
runBatch G (const x) C
  (Batch_replace_contents (Done c) v)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk16f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>G B</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
runBatch G (const x) (B -&gt; C) b =
runBatch G (const x) (B -&gt; C) (Batch_replace_contents b v)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk16f"><hr></label><div class="goal-conclusion">runBatch G (const x) C (b ‚ßÜ a) =
runBatch G (const x) C
  (Batch_replace_contents (b ‚ßÜ a) v)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk170" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk170">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>G B</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (Done c)) A&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">runBatch G (const x) C (Done c) =
runBatch G (const x) C
  (Batch_replace_contents (Done c) v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk171" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk171">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>G B</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
runBatch G (const x) (B -&gt; C) b =
runBatch G (const x) (B -&gt; C) (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">runBatch G (const x) C (b ‚ßÜ a) =
runBatch G (const x) C
  (Batch_replace_contents (b ‚ßÜ a) v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk172" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk172"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>G B</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
runBatch G (const x) (B -&gt; C) b =
runBatch G (const x) (B -&gt; C) (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">runBatch G (const x) (B -&gt; C) b &lt;‚ãÜ&gt; const x a =
runBatch G (const x) (B -&gt; C)
  (Batch_replace_contents b (Vector_tl v)) &lt;‚ãÜ&gt;
const x (Vector_hd v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk173" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk173">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>G B</span></span></span><br><span><var>A'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch (b ‚ßÜ a)) A&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">v</span> : Vector (length_Batch b) A&#39;,
runBatch G (const x) (B -&gt; C) b =
runBatch G (const x) (B -&gt; C) (Batch_replace_contents b v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">runBatch G (const x) (B -&gt; C) b =
runBatch G (const x) (B -&gt; C)
  (Batch_replace_contents b (Vector_tl v))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> IHb.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk174" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk174"><span class="kn">Lemma</span> <span class="nf">Batch_eq_iff</span>:
      <span class="kr">forall</span> `(b1: Batch A B C) `(b2: Batch A B C),
        b1 = b2 &lt;-&gt;
          Batch_make b1 ~!~ Batch_make b2 /\
            Batch_contents b1 ~~ Batch_contents b2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> <span class="nv">b2</span> : Batch A B C),
b1 = b2 &lt;-&gt;
Batch_make b1 ~!~ Batch_make b2 /\
Batch_contents b1 ~~ Batch_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk175" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk175"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b1</span> <span class="nv">b2</span> : Batch A B C),
b1 = b2 &lt;-&gt;
Batch_make b1 ~!~ Batch_make b2 /\
Batch_contents b1 ~~ Batch_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk176" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk176"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">b1 = b2 &lt;-&gt;
Batch_make b1 ~!~ Batch_make b2 /\
Batch_contents b1 ~~ Batch_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk177" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk177"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">b1 = b2 -&gt;
Batch_make b1 ~!~ Batch_make b2 /\
Batch_contents b1 ~~ Batch_contents b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk178" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><label class="goal-separator" for="batch-v-chk178"><hr></label><div class="goal-conclusion">Batch_make b1 ~!~ Batch_make b2 /\
Batch_contents b1 ~~ Batch_contents b2 -&gt; b1 = b2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk179" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk179">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">b1 = b2 -&gt;
Batch_make b1 ~!~ Batch_make b2 /\
Batch_contents b1 ~~ Batch_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk17a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk17a"><span class="nb">intros</span>; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b2 ~!~ Batch_make b2 /\
Batch_contents b2 ~~ Batch_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk17b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk17b"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b2 ~!~ Batch_make b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk17c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><label class="goal-separator" for="batch-v-chk17c"><hr></label><div class="goal-conclusion">Batch_contents b2 ~~ Batch_contents b2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk17d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk17d"><span class="mi">2</span>: <span class="bp">reflexivity</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b2 ~!~ Batch_make b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk17e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk17e"><span class="nb">unfold</span> Vector_fun_sim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length_Batch b2 = length_Batch b2 /\
(<span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b2) B,
 v1 ~~ v2 -&gt; Batch_make b2 v1 = Batch_make b2 v2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk17f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk17f"><span class="nb">split</span>; <span class="kp">try</span> <span class="bp">reflexivity</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">v1</span> <span class="nv">v2</span> : Vector (length_Batch b2) B,
v1 ~~ v2 -&gt; Batch_make b2 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk180" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk180">introv Hsim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>v1, v2</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b2) B</span></span></span><br><span><var>Hsim</var><span class="hyp-type"><b>: </b><span>v1 ~~ v2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b2 v1 = Batch_make b2 v2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto using</span> Batch_make_sim1.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk181" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk181">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b1 ~!~ Batch_make b2 /\
Batch_contents b1 ~~ Batch_contents b2 -&gt; b1 = b2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk182" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk182"><span class="nb">intros</span> [Hmake Hcontents].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>Hmake</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>Hcontents</var><span class="hyp-type"><b>: </b><span>Batch_contents b1 ~~ Batch_contents b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">b1 = b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk183" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk183"><span class="nb">rewrite</span> &lt;- (Batch_get_put b1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>Hmake</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>Hcontents</var><span class="hyp-type"><b>: </b><span>Batch_contents b1 ~~ Batch_contents b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b1 (Batch_contents b1) = b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk184" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk184"><span class="nb">rewrite</span> &lt;- (Batch_get_put b2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>Hmake</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>Hcontents</var><span class="hyp-type"><b>: </b><span>Batch_contents b1 ~~ Batch_contents b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_replace_contents b1 (Batch_contents b1) =
Batch_replace_contents b2 (Batch_contents b2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk185" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk185"><span class="nb">apply</span> Batch_replace_sim3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>Hmake</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>Hcontents</var><span class="hyp-type"><b>: </b><span>Batch_contents b1 ~~ Batch_contents b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">shape b1 = shape b2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk186" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>Hmake</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>Hcontents</var><span class="hyp-type"><b>: </b><span>Batch_contents b1 ~~ Batch_contents b2</span></span></span><br></div><label class="goal-separator" for="batch-v-chk186"><hr></label><div class="goal-conclusion">Batch_contents b1 ~~ Batch_contents b2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk187" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk187"><span class="bp">now</span> <span class="nb">apply</span> Batch_make_shape_rev.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b1, b2</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>Hmake</var><span class="hyp-type"><b>: </b><span>Batch_make b1 ~!~ Batch_make b2</span></span></span><br><span><var>Hcontents</var><span class="hyp-type"><b>: </b><span>Batch_contents b1 ~~ Batch_contents b2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_contents b1 ~~ Batch_contents b2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">spec</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="sd">(** ** Representation theorems *)</span>
  <span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk188" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk188"><span class="kn">Lemma</span> <span class="nf">runBatch_repr1</span> `{Applicative G}:
    <span class="kr">forall</span> `(b: Batch A B C) (f: A -&gt; G B),
      map (F := G) (Batch_make b)
          (traverse (T := Vector (length_Batch b)) f (Batch_contents b)) =
        forwards (runBatch (Backwards G) (mkBackwards ‚àò f) _ b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">f</span> : A -&gt; G B),
map (Batch_make b) (traverse f (Batch_contents b)) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk189" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk189"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">f</span> : A -&gt; G B),
map (Batch_make b) (traverse f (Batch_contents b)) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk18a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk18a"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make b) (traverse f (Batch_contents b)) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk18b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk18b"><span class="nb">induction</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (Done c))
  (traverse f (Batch_contents (Done c))) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C (Done c))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk18c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><label class="goal-separator" for="batch-v-chk18c"><hr></label><div class="goal-conclusion">map (Batch_make (b ‚ßÜ a))
  (traverse f (Batch_contents (b ‚ßÜ a))) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C (b ‚ßÜ a))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk18d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk18d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (Done c))
  (traverse f (Batch_contents (Done c))) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C (Done c))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk18e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk18e"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (<span class="kr">fun</span> <span class="nv">_</span> : Vector <span class="mi">0</span> B =&gt; c)
  (pure
     (exist (<span class="kr">fun</span> <span class="nv">l</span> : list B =&gt; length l = <span class="mi">0</span>) nil
        eq_refl)) = pure c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk18f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk18f"><span class="nb">rewrite</span> app_pure_natural.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure c = pure c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk190" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk190">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (b ‚ßÜ a))
  (traverse f (Batch_contents (b ‚ßÜ a))) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C (b ‚ßÜ a))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk191" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk191"><span class="nb">rewrite</span> Batch_contents_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (b ‚ßÜ a))
  (traverse f
     (vcons (length_Batch b) a (Batch_contents b))) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C (b ‚ßÜ a))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk192" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk192"><span class="nb">unfold</span> length_Batch <span class="nb">at</span> <span class="mi">2</span>. <span class="c">(* hidden *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (b ‚ßÜ a))
  (traverse f
     (vcons (length_Batch b) a (Batch_contents b))) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C (b ‚ßÜ a))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk193" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk193"><span class="nb">rewrite</span> traverse_Vector_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (b ‚ßÜ a))
  (pure (vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
   traverse f (Batch_contents b)) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) C (b ‚ßÜ a))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk194" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk194"><span class="nb">rewrite</span> runBatch_rw2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (b ‚ßÜ a))
  (pure (vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
   traverse f (Batch_contents b)) =
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b &lt;‚ãÜ&gt;
   (mkBackwards ‚àò f) a)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk195" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk195"><span class="nb">rewrite</span> forwards_ap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make (b ‚ßÜ a))
  (pure (vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
   traverse f (Batch_contents b)) =
map evalAt (forwards ((mkBackwards ‚àò f) a)) &lt;‚ãÜ&gt;
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk196" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk196"><span class="nb">rewrite</span> map_ap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (compose (Batch_make (b ‚ßÜ a)))
  (pure (vcons (length_Batch b)) &lt;‚ãÜ&gt; f a) &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
map evalAt (forwards ((mkBackwards ‚àò f) a)) &lt;‚ãÜ&gt;
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk197" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk197"><span class="nb">rewrite</span> map_ap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (compose (compose (Batch_make (b ‚ßÜ a))))
  (pure (vcons (length_Batch b))) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
map evalAt (forwards ((mkBackwards ‚àò f) a)) &lt;‚ãÜ&gt;
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk198" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk198"><span class="nb">rewrite</span> app_pure_natural.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
map evalAt (forwards ((mkBackwards ‚àò f) a)) &lt;‚ãÜ&gt;
forwards
  (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk199" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk199"><span class="nb">rewrite</span> &lt;- IHb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
map evalAt (forwards ((mkBackwards ‚àò f) a)) &lt;‚ãÜ&gt;
map (Batch_make b) (traverse f (Batch_contents b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk19a" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk19a"><span class="nb">rewrite</span> map_to_ap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
pure evalAt &lt;‚ãÜ&gt; forwards ((mkBackwards ‚àò f) a) &lt;‚ãÜ&gt;
map (Batch_make b) (traverse f (Batch_contents b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk19b" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk19b"><span class="nb">rewrite</span> &lt;- ap_map.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
map (precompose (Batch_make b))
  (pure evalAt &lt;‚ãÜ&gt; forwards ((mkBackwards ‚àò f) a)) &lt;‚ãÜ&gt;
traverse f (Batch_contents b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk19c" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk19c"><span class="nb">rewrite</span> map_ap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
map (compose (precompose (Batch_make b)))
  (pure evalAt) &lt;‚ãÜ&gt; forwards ((mkBackwards ‚àò f) a) &lt;‚ãÜ&gt;
traverse f (Batch_contents b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk19d" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk19d"><span class="nb">rewrite</span> app_pure_natural.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) &lt;‚ãÜ&gt; f a &lt;‚ãÜ&gt;
traverse f (Batch_contents b) =
pure (precompose (Batch_make b) ‚àò evalAt) &lt;‚ãÜ&gt;
forwards ((mkBackwards ‚àò f) a) &lt;‚ãÜ&gt;
traverse f (Batch_contents b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk19e" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk19e">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) &lt;‚ãÜ&gt; f a =
pure (precompose (Batch_make b) ‚àò evalAt) &lt;‚ãÜ&gt;
forwards ((mkBackwards ‚àò f) a)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk19f" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk19f">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure
  (compose (Batch_make (b ‚ßÜ a))
   ‚àò vcons (length_Batch b)) =
pure (precompose (Batch_make b) ‚àò evalAt)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a0">fequal.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compose (Batch_make (b ‚ßÜ a)) ‚àò vcons (length_Batch b) =
precompose (Batch_make b) ‚àò evalAt</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a1">ext b&#39; v&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(compose (Batch_make (b ‚ßÜ a)) ‚àò vcons (length_Batch b))
  b&#39; v&#39; = (precompose (Batch_make b) ‚àò evalAt) b&#39; v&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a2"><span class="nb">unfold</span> compose, precompose, evalAt.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make (b ‚ßÜ a) (vcons (length_Batch b) b&#39; v&#39;) =
Batch_make b v&#39; b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a3"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b
  (Vector_tl (vcons (length_Batch b) b&#39; v&#39;))
  (Vector_hd (vcons (length_Batch b) b&#39; v&#39;)) =
Batch_make b v&#39; b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a4"><span class="nb">rewrite</span> Vector_tl_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b v&#39;
  (Vector_hd (vcons (length_Batch b) b&#39; v&#39;)) =
Batch_make b v&#39; b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a5"><span class="nb">rewrite</span> Vector_hd_vcons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (Batch_make b) (traverse f (Batch_contents b)) =
forwards (runBatch (Backwards G) (mkBackwards ‚àò f) (B -&gt; C) b)</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>v'</var><span class="hyp-type"><b>: </b><span>Vector (length_Batch b) B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_make b v&#39; b&#39; = Batch_make b v&#39; b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a6"><span class="kn">Lemma</span> <span class="nf">runBatch_repr2</span> `{Applicative G}:
    <span class="kr">forall</span> `(b: Batch A B C) (f: A -&gt; G B),
      runBatch G f _ b =
        map (F := G) (Batch_make b)
            (forwards (traverse (G := (Backwards G))
                                (T := Vector (length_Batch b))
                                (mkBackwards ‚àò f)
                                (Batch_contents b))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">f</span> : A -&gt; G B),
runBatch G f C b =
map (Batch_make b)
  (forwards
     (traverse (mkBackwards ‚àò f) (Batch_contents b)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> : <span class="kt">Type</span>) (<span class="nv">b</span> : Batch A B C) (<span class="nv">f</span> : A -&gt; G B),
runBatch G f C b =
map (Batch_make b)
  (forwards
     (traverse (mkBackwards ‚àò f) (Batch_contents b)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a8"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">runBatch G f C b =
map (Batch_make b)
  (forwards
     (traverse (mkBackwards ‚àò f) (Batch_contents b)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1a9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1a9"><span class="nb">symmetry</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (Batch_make b)
  (forwards
     (traverse (mkBackwards ‚àò f) (Batch_contents b))) =
runBatch G f C b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1aa" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1aa">change_left
      (forwards
         (map (F := Backwards G) (Batch_make b)
              (traverse (G := Backwards G) (mkBackwards ‚àò f) (Batch_contents b)))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">forwards
  (map (Batch_make b)
     (traverse (mkBackwards ‚àò f) (Batch_contents b))) =
runBatch G f C b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ab" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ab"><span class="nb">rewrite</span> runBatch_repr1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">forwards
  (forwards
     (runBatch (Backwards (Backwards G))
        (mkBackwards ‚àò (mkBackwards ‚àò f)) C b)) =
runBatch G f C b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ac" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ac"><span class="nb">rewrite</span> runBatch_spec.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">forwards
  (forwards
     ((map extract_Batch
       ‚àò traverse (mkBackwards ‚àò (mkBackwards ‚àò f))) b)) =
runBatch G f C b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ad" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ad"><span class="nb">rewrite</span> runBatch_spec.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">forwards
  (forwards
     ((map extract_Batch
       ‚àò traverse (mkBackwards ‚àò (mkBackwards ‚àò f))) b)) =
(map extract_Batch ‚àò traverse f) b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ae" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ae">change_left
      (map (F := G) extract_Batch
           (forwards (
                forwards (
                    traverse (G := Backwards (Backwards G))
                             (mkBackwards ‚àò (mkBackwards ‚àò f)) b)))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map extract_Batch
  (forwards
     (forwards
        (traverse (mkBackwards ‚àò (mkBackwards ‚àò f)) b))) =
(map extract_Batch ‚àò traverse f) b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1af" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1af"><span class="nb">rewrite</span> traverse_double_backwards.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>G</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span> -&gt; <span class="kt">Type</span></span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Map G</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Pure G</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Mult G</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Applicative G</span></span></span><br><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>A -&gt; G B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map extract_Batch (traverse f b) =
(map extract_Batch ‚àò traverse f) b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">deconstruction</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="sd">(** * Deconstructing &lt;&lt;Batch A B C&gt;&gt; with an extrinsic approach *)</span>
<span class="sd">(******************************************************************************)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Functors.Option.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">deconstruction_extrinsic</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">Batch_to_makeFn</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>} (<span class="nv">b</span>: Batch A B C) (<span class="nv">l</span>: list B): option C :=
    <span class="kr">match</span> b <span class="kr">with</span>
    | Done c =&gt;
        <span class="kr">match</span> l <span class="kr">with</span>
        | nil =&gt; Some c
        | _ =&gt; None
        <span class="kr">end</span>
    | Step rest a =&gt;
        <span class="kr">match</span> (List.rev l) <span class="kr">with</span>
        | (b&#39; :: bs) =&gt;
            map (evalAt  b&#39;) (Batch_to_makeFn rest bs)
        | _ =&gt; None
        <span class="kr">end</span>
    <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b0"><span class="kn">Lemma</span> <span class="nf">basic0</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span> <span class="nv">C&#39;</span>} (<span class="nv">b</span>: Batch A B C) (<span class="nv">l</span>: list B) (<span class="nv">f</span>: C -&gt; C&#39;):
    map f (Batch_to_makeFn b l) = Batch_to_makeFn (map f b) l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C, C'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_to_makeFn b l) =
Batch_to_makeFn (map f b) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C, C'</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_to_makeFn b l) =
Batch_to_makeFn (map f b) l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b2"><span class="nb">induction</span> b; <span class="nb">induction</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_to_makeFn (Done c) nil) =
Batch_to_makeFn (map f (Done c)) nil</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1b3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>map f (Batch_to_makeFn (Done c) l) = Batch_to_makeFn (map f (Done c)) l</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1b3"><hr></label><div class="goal-conclusion">map f (Batch_to_makeFn (Done c) (a :: l)) =
Batch_to_makeFn (map f (Done c)) (a :: l)</div></blockquote><input class="alectryon-extra-goal-toggle" id="batch-v-chk1b4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b nil) = Batch_to_makeFn (map f b) nil</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1b4"><hr></label><div class="goal-conclusion">map f (Batch_to_makeFn (b ‚ßÜ a) nil) =
Batch_to_makeFn (map f (b ‚ßÜ a)) nil</div></blockquote><input class="alectryon-extra-goal-toggle" id="batch-v-chk1b5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b (a0 :: l)) = Batch_to_makeFn (map f b) (a0 :: l)</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b l) = Batch_to_makeFn (map f b) l) -&gt;
map f (Batch_to_makeFn (b ‚ßÜ a) l) = Batch_to_makeFn (map f (b ‚ßÜ a)) l</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1b5"><hr></label><div class="goal-conclusion">map f (Batch_to_makeFn (b ‚ßÜ a) (a0 :: l)) =
Batch_to_makeFn (map f (b ‚ßÜ a)) (a0 :: l)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_to_makeFn (Done c) nil) =
Batch_to_makeFn (map f (Done c)) nil</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>map f (Batch_to_makeFn (Done c) l) = Batch_to_makeFn (map f (Done c)) l</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_to_makeFn (Done c) (a :: l)) =
Batch_to_makeFn (map f (Done c)) (a :: l)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b nil) = Batch_to_makeFn (map f b) nil</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_to_makeFn (b ‚ßÜ a) nil) =
Batch_to_makeFn (map f (b ‚ßÜ a)) nil</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1b9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1b9">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b (a0 :: l)) = Batch_to_makeFn (map f b) (a0 :: l)</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b l) = Batch_to_makeFn (map f b) l) -&gt;
map f (Batch_to_makeFn (b ‚ßÜ a) l) = Batch_to_makeFn (map f (b ‚ßÜ a)) l</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f (Batch_to_makeFn (b ‚ßÜ a) (a0 :: l)) =
Batch_to_makeFn (map f (b ‚ßÜ a)) (a0 :: l)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ba" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ba"><span class="nb">cbn</span> <span class="kr">in</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>a0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b (a0 :: l)) = Batch_to_makeFn (map f b) (a0 :: l)</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b l) = Batch_to_makeFn (map f b) l) -&gt;
map f
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn b bs)
<span class="kr">end</span> =
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn (map (compose f) b) bs)
<span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f
  <span class="kr">match</span> List.rev l ++ a0 :: nil <span class="kr">with</span>
  | nil =&gt; None
  | b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn b bs)
  <span class="kr">end</span> =
<span class="kr">match</span> List.rev l ++ a0 :: nil <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt;
    map (evalAt b&#39;)
      (Batch_to_makeFn (map (compose f) b) bs)
<span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1bb" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1bb"><span class="nb">rename</span> a0 <span class="nb">into</span> b&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b (b&#39; :: l)) = Batch_to_makeFn (map f b) (b&#39; :: l)</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b l) = Batch_to_makeFn (map f b) l) -&gt;
map f
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn b bs)
<span class="kr">end</span> =
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn (map (compose f) b) bs)
<span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f
  <span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
  | nil =&gt; None
  | b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn b bs)
  <span class="kr">end</span> =
<span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt;
    map (evalAt b&#39;)
      (Batch_to_makeFn (map (compose f) b) bs)
<span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1bc" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1bc"><span class="nb">specialize</span> (IHb (f ‚àò evalAt b&#39;)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (f ‚àò evalAt b&#39;) (Batch_to_makeFn b (b&#39; :: l)) =
Batch_to_makeFn (map (f ‚àò evalAt b&#39;) b) (b&#39; :: l)</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn b l) = Batch_to_makeFn (map f b) l) -&gt;
map f
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn b bs)
<span class="kr">end</span> =
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn (map (compose f) b) bs)
<span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f
  <span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
  | nil =&gt; None
  | b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn b bs)
  <span class="kr">end</span> =
<span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt;
    map (evalAt b&#39;)
      (Batch_to_makeFn (map (compose f) b) bs)
<span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1bd" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1bd"><span class="nb">destruct</span> b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (f ‚àò evalAt b&#39;) (Batch_to_makeFn (Done c) (b&#39; :: l)) =
Batch_to_makeFn (map (f ‚àò evalAt b&#39;) (Done c)) (b&#39; :: l)</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn (Done c) l) = Batch_to_makeFn (map f (Done c)) l) -&gt;
map f
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn (Done c) bs)
<span class="kr">end</span> =
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn (map (compose f) (Done c)) bs)
<span class="kr">end</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map f
  <span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
  | nil =&gt; None
  | b&#39; :: bs =&gt;
      map (evalAt b&#39;) (Batch_to_makeFn (Done c) bs)
  <span class="kr">end</span> =
<span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt;
    map (evalAt b&#39;)
      (Batch_to_makeFn (map (compose f) (Done c)) bs)
<span class="kr">end</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1be" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C', C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; B -&gt; C)</span></span></span><br><span><var>a0, a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>C -&gt; C&#39;</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>map (f ‚àò evalAt b&#39;) (Batch_to_makeFn (b ‚ßÜ a0) (b&#39; :: l)) =
Batch_to_makeFn (map (f ‚àò evalAt b&#39;) (b ‚ßÜ a0)) (b&#39; :: l)</span></span></span><br><span><var>IHl</var><span class="hyp-type"><b>: </b><span>(<span class="kr">forall</span> <span class="nv">f</span> : (B -&gt; C) -&gt; C&#39;,
map f (Batch_to_makeFn (b ‚ßÜ a0) l) = Batch_to_makeFn (map f (b ‚ßÜ a0)) l) -&gt;
map f
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn (b ‚ßÜ a0) bs)
<span class="kr">end</span> =
<span class="kr">match</span> List.rev l <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn (map (compose f) (b ‚ßÜ a0)) bs)
<span class="kr">end</span></span></span></span><br></div><label class="goal-separator" for="batch-v-chk1be"><hr></label><div class="goal-conclusion">map f
  <span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
  | nil =&gt; None
  | b&#39; :: bs =&gt;
      map (evalAt b&#39;) (Batch_to_makeFn (b ‚ßÜ a0) bs)
  <span class="kr">end</span> =
<span class="kr">match</span> List.rev l ++ b&#39; :: nil <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt;
    map (evalAt b&#39;)
      (Batch_to_makeFn (map (compose f) (b ‚ßÜ a0)) bs)
<span class="kr">end</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Abort</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1bf" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1bf"><span class="kn">Lemma</span> <span class="nf">Batch_to_makeFn_rw11</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>}: <span class="kr">forall</span> <span class="nv">c</span>,
      Batch_to_makeFn (@Done A B C c) nil = Some c.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">c</span> : C, Batch_to_makeFn (Done c) nil = Some c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">c</span> : C, Batch_to_makeFn (Done c) nil = Some c</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c1"><span class="kn">Lemma</span> <span class="nf">Batch_to_makeFn_rw12</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>} <span class="nv">b&#39;</span> <span class="nv">l</span>: <span class="kr">forall</span> <span class="nv">c</span>,
      Batch_to_makeFn (@Done A B C c) (b&#39; :: l) = None.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">c</span> : C,
Batch_to_makeFn (Done c) (b&#39; :: l) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">c</span> : C,
Batch_to_makeFn (Done c) (b&#39; :: l) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c3"><span class="kn">Lemma</span> <span class="nf">Batch_to_makeFn_rw21</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>}:
    <span class="kr">forall</span> (<span class="nv">b</span>: Batch A B (B -&gt; C)) (<span class="nv">a</span>: A),
       Batch_to_makeFn (b ‚ßÜ a) nil = None.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B (B -&gt; C)) (<span class="nv">a</span> : A),
Batch_to_makeFn (b ‚ßÜ a) nil = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B (B -&gt; C)) (<span class="nv">a</span> : A),
Batch_to_makeFn (b ‚ßÜ a) nil = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c5"><span class="kn">Lemma</span> <span class="nf">Batch_to_makeFn_rw22</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>}:
    <span class="kr">forall</span> (<span class="nv">b</span>: Batch A B (B -&gt; C)) (<span class="nv">a</span>: A) (<span class="nv">l</span> : list B) (<span class="nv">b&#39;</span> : B),
       Batch_to_makeFn (b ‚ßÜ a) (l ++ b&#39; :: nil) =
        Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B (B -&gt; C)) (<span class="nv">a</span> : A) (<span class="nv">l</span> : list B)
  (<span class="nv">b&#39;</span> : B),
Batch_to_makeFn (b ‚ßÜ a) (l ++ b&#39; :: nil) =
Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">b</span> : Batch A B (B -&gt; C)) (<span class="nv">a</span> : A) (<span class="nv">l</span> : list B)
  (<span class="nv">b&#39;</span> : B),
Batch_to_makeFn (b ‚ßÜ a) (l ++ b&#39; :: nil) =
Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c7"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Batch_to_makeFn (b ‚ßÜ a) (l ++ b&#39; :: nil) =
Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c8"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">match</span> List.rev (l ++ b&#39; :: nil) <span class="kr">with</span>
| nil =&gt; None
| b&#39; :: bs =&gt; map (evalAt b&#39;) (Batch_to_makeFn b bs)
<span class="kr">end</span> = Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1c9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1c9"><span class="nb">rewrite</span> List.rev_unit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (evalAt b&#39;) (Batch_to_makeFn b (List.rev l)) =
Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ca" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ca"><span class="nb">rewrite</span> map_to_ap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure (evalAt b&#39;) &lt;‚ãÜ&gt; Batch_to_makeFn b (List.rev l) =
Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1cb" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1cb"><span class="nb">rewrite</span> ap3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>b'</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure (evalAt b&#39;) &lt;‚ãÜ&gt; Batch_to_makeFn b (List.rev l) =
pure (<span class="kr">fun</span> <span class="nv">f</span> : B -&gt; C =&gt; f b&#39;) &lt;‚ãÜ&gt;
Batch_to_makeFn b (List.rev l)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1cc" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1cc"><span class="kn">Lemma</span> <span class="nf">basic1</span> {<span class="nv">A</span> <span class="nv">B</span> <span class="nv">C</span>} (<span class="nv">b</span>: Batch A B C) (<span class="nv">l</span>: list B):
    length l = length_Batch b -&gt;
    {c | Batch_to_makeFn b l = Some c}.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length l = length_Batch b -&gt;
{c : C | Batch_to_makeFn b l = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1cd" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1cd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length l = length_Batch b -&gt;
{c : C | Batch_to_makeFn b l = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ce" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ce"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length l = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C | Batch_to_makeFn b l = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1cf" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1cf"><span class="nb">generalize dependent</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt;
{c : C | Batch_to_makeFn b l = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d0"><span class="nb">induction</span> b; <span class="nb">intros</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length l = length_Batch (Done c) -&gt;
{c0 : C | Batch_to_makeFn (Done c) l = Some c0}</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1d1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt; {c : B -&gt; C | Batch_to_makeFn b l = Some c}</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1d1"><hr></label><div class="goal-conclusion">length l = length_Batch (b ‚ßÜ a) -&gt;
{c : C | Batch_to_makeFn (b ‚ßÜ a) l = Some c}</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length l = length_Batch (Done c) -&gt;
{c0 : C | Batch_to_makeFn (Done c) l = Some c0}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d3"><span class="nb">destruct</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length nil = length_Batch (Done c) -&gt;
{c0 : C | Batch_to_makeFn (Done c) nil = Some c0}</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1d4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1d4"><hr></label><div class="goal-conclusion">length (b :: l) = length_Batch (Done c) -&gt;
{c0 : C | Batch_to_makeFn (Done c) (b :: l) = Some c0}</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d5">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length nil = length_Batch (Done c) -&gt;
{c0 : C | Batch_to_makeFn (Done c) nil = Some c0}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d6"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> = <span class="mi">0</span> -&gt; {c0 : C | Some c = Some c0}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d7"><span class="kr">exists</span> <span class="nv">c</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> = <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some c = Some c</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d8">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (b :: l) = length_Batch (Done c) -&gt;
{c0 : C | Batch_to_makeFn (Done c) (b :: l) = Some c0}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1d9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1d9"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (length l) = <span class="mi">0</span> -&gt; {c : C | None = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1da" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1da">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt; {c : B -&gt; C | Batch_to_makeFn b l = Some c}</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length l = length_Batch (b ‚ßÜ a) -&gt;
{c : C | Batch_to_makeFn (b ‚ßÜ a) l = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1db" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1db"><span class="nb">destruct</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt; {c : B -&gt; C | Batch_to_makeFn b l = Some c}</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length nil = length_Batch (b ‚ßÜ a) -&gt;
{c : C | Batch_to_makeFn (b ‚ßÜ a) nil = Some c}</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1dc" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt; {c : B -&gt; C | Batch_to_makeFn b l = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1dc"><hr></label><div class="goal-conclusion">length (b0 :: l) = length_Batch (b ‚ßÜ a) -&gt;
{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1dd" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1dd">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt; {c : B -&gt; C | Batch_to_makeFn b l = Some c}</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length nil = length_Batch (b ‚ßÜ a) -&gt;
{c : C | Batch_to_makeFn (b ‚ßÜ a) nil = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">inversion</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1de" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1de">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt; {c : B -&gt; C | Batch_to_makeFn b l = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (b0 :: l) = length_Batch (b ‚ßÜ a) -&gt;
{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1df" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1df"><span class="nb">intro</span> Heq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : list B,
length l = length_Batch b -&gt; {c : B -&gt; C | Batch_to_makeFn b l = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e0"><span class="nb">specialize</span> (IHb (List.rev l)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b -&gt;
{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e1"><span class="nb">assert</span> (length (List.rev l) = length_Batch b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b -&gt;
{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (List.rev l) = length_Batch b</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1e2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b -&gt;
{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1e2"><hr></label><div class="goal-conclusion">{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e3">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b -&gt;
{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length (List.rev l) = length_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e4" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e4"><span class="nb">rewrite</span> List.rev_length.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b -&gt;
{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">length l = length_Batch b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e5" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e5"><span class="nb">apply</span> S_uncons.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b -&gt;
{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S (length l) = S (length_Batch b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">assumption</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e6" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e6">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b -&gt;
{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e7" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e7"><span class="nb">specialize</span> (IHb H).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>IHb</var><span class="hyp-type"><b>: </b><span>{c : B -&gt; C | Batch_to_makeFn b (List.rev l) = Some c}</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e8" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e8"><span class="nb">destruct</span> IHb <span class="kr">as</span> [c pf].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev l) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C | Batch_to_makeFn (b ‚ßÜ a) (b0 :: l) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1e9" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1e9"><span class="nb">rewrite</span> &lt;- (List.rev_involutive l).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev l) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C
| Batch_to_makeFn (b ‚ßÜ a)
    (b0 :: List.rev (List.rev l)) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ea" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ea"><span class="nb">rewrite</span> &lt;- List.rev_unit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev l) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C
| Batch_to_makeFn (b ‚ßÜ a)
    (List.rev (List.rev l ++ b0 :: nil)) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1eb" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1eb"><span class="nb">rewrite</span> List.rev_app_distr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev l) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev l) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C
| Batch_to_makeFn (b ‚ßÜ a)
    (List.rev (b0 :: nil) ++ List.rev (List.rev l)) =
  Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ec" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ec"><span class="nb">destruct</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev nil) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: nil) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev nil) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C
| Batch_to_makeFn (b ‚ßÜ a)
    (List.rev (b0 :: nil) ++ List.rev (List.rev nil)) =
  Some c}</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="batch-v-chk1ed" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev (b1 :: l)) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: b1 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev (b1 :: l)) = length_Batch b</span></span></span><br></div><label class="goal-separator" for="batch-v-chk1ed"><hr></label><div class="goal-conclusion">{c : C
| Batch_to_makeFn (b ‚ßÜ a)
    (List.rev (b0 :: nil) ++
     List.rev (List.rev (b1 :: l))) = Some c}</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ee" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ee">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev nil) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: nil) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev nil) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C
| Batch_to_makeFn (b ‚ßÜ a)
    (List.rev (b0 :: nil) ++ List.rev (List.rev nil)) =
  Some c}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1ef" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1ef"><span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev nil) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: nil) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev nil) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C
| map (evalAt b0) (Batch_to_makeFn b nil) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1f0" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1f0"><span class="kr">exists</span> (<span class="nv">c</span> <span class="nv">b0</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev nil) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: nil) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev nil) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (evalAt b0) (Batch_to_makeFn b nil) = Some (c b0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1f1" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1f1"><span class="nb">cbn</span> <span class="kr">in</span> pf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b nil = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: nil) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev nil) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (evalAt b0) (Batch_to_makeFn b nil) = Some (c b0)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1f2" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1f2"><span class="nb">rewrite</span> pf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b nil = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: nil) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev nil) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">map (evalAt b0) (Some c) = Some (c b0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">          </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="batch-v-chk1f3" style="display: none" type="checkbox"><label class="alectryon-input" for="batch-v-chk1f3">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A, B, C</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>Batch A B (B -&gt; C)</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>b1</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>list B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>B -&gt; C</span></span></span><br><span><var>pf</var><span class="hyp-type"><b>: </b><span>Batch_to_makeFn b (List.rev (b1 :: l)) = Some c</span></span></span><br><span><var>b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>Heq</var><span class="hyp-type"><b>: </b><span>length (b0 :: b1 :: l) = length_Batch (b ‚ßÜ a)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>length (List.rev (b1 :: l)) = length_Batch b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{c : C
| Batch_to_makeFn (b ‚ßÜ a)
    (List.rev (b0 :: nil) ++
     List.rev (List.rev (b1 :: l))) = Some c}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Abort</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(*</span>
<span class="c">  Lemma Batch_repr {A C}:</span>
<span class="c">    forall (b: Batch A A C),</span>
<span class="c">      Batch_to_makeFn b (List.rev (Batch_to_list b)) = Some (extract_Batch b).</span>
<span class="c">  Proof.</span>
<span class="c">    intros.</span>
<span class="c">    induction b.</span>
<span class="c">    - reflexivity.</span>
<span class="c">    - rewrite Batch_to_list_rw2.</span>
<span class="c">      assert (forall {A B C} (b: Batch A B (B -&gt; C)) (a: A) (l : list B) (b&#39;: B),</span>
<span class="c">      Batch_to_makeFn (b ‚ßÜ a) (l ++ b&#39; :: nil) =</span>
<span class="c">        Batch_to_makeFn b (List.rev l) &lt;‚ãÜ&gt; pure b&#39;).</span>
<span class="c">      { intros.</span>
<span class="c">        rewrite Batch_to_makeFn_rw22.</span>
<span class="c">        reflexivity. }</span>
<span class="c">      rewrite List.rev_app_distr.</span>
<span class="c">      cbn.</span>
<span class="c">  Qed.</span>
<span class="c">  *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">deconstruction_extrinsic</span>.</span></span></pre>
</div>
</div></body>
</html>
